<!DOCTYPE html>
<html lang="en">

    <!-- Basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
   
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
 
     <!-- Site Metas -->
    <title>Home Pi</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- ALL VERSION CSS -->
    <link rel="stylesheet" href="css/versions.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">
	<link rel="stylesheet" href="/path/to/styles/default.css">
	<script src="/path/to/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

    <!-- Modernizer for Portfolio -->
    <script src="js/modernizer.js"></script>

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body class="host_version"> 

	<!-- Modal -->
	<div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header tit-up">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Customer Login</h4>
			</div>
			<div class="modal-body customer-box">
				<!-- Nav tabs -->
				<ul class="nav nav-tabs">
					<li><a class="active" href="#Login" data-toggle="tab">Login</a></li>
					<li><a href="#Registration" data-toggle="tab">Registration</a></li>
				</ul>
				<!-- Tab panes -->
				<div class="tab-content">
					<div class="tab-pane active" id="Login">
						<form role="form" class="form-horizontal">
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" id="email1" placeholder="Name" type="text">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" id="exampleInputPassword1" placeholder="Email" type="email">
								</div>
							</div>
							<div class="row">
								<div class="col-sm-10">
									<button type="submit" class="btn btn-light btn-radius btn-brd grd1">
										Submit
									</button>
									<a class="for-pwd" href="javascript:;">Forgot your password?</a>
								</div>
							</div>
						</form>
					</div>
					<div class="tab-pane" id="Registration">
						<form role="form" class="form-horizontal">
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" placeholder="Name" type="text">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" id="email" placeholder="Email" type="email">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" id="mobile" placeholder="Mobile" type="email">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-12">
									<input class="form-control" id="password" placeholder="Password" type="password">
								</div>
							</div>
							<div class="row">							
								<div class="col-sm-10">
									<button type="button" class="btn btn-light btn-radius btn-brd grd1">
										Save &amp; Continue
									</button>
									<button type="button" class="btn btn-light btn-radius btn-brd grd1">
										Cancel</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	  </div>
	</div>

<!--    &lt;!&ndash; LOADER &ndash;&gt;-->
<!--	<div id="preloader">-->
<!--		<div class="loader-container">-->
<!--			<div class="progress-br float shadow">-->
<!--				<div class="progress__item"></div>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
	<!-- END LOADER -->	
	
	<!-- Start header -->
	<header class="top-navbar">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<div class="container-fluid">
				<a class="navbar-brand" href="index.html">
					<img id ="logo" src="images/cornell-reduced-white.svg" alt="" />
				</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbars-host" aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
					<span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbars-host">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item active"><a class="nav-link" href="index.html">Home</a></li>
						<li class="nav-item"><a class="nav-link" href="#objective">Objective</a></li>

						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#Design" id="dropdown-a" data-toggle="dropdown">Design </a>
							<div class="dropdown-menu" aria-labelledby="dropdown-a">
								<a class="dropdown-item" href="#CCTV Server">CCTV Server </a>
								<a class="dropdown-item" href="#Servo Control">Servo Control</a>
								<a class="dropdown-item" href="#TPU">TPU-Based Face Recognition</a>
								<a class="dropdown-item" href="#android application">Android Application</a>
								<a class="dropdown-item" href="#Mutliprocessing Algorithms">Mutliprocessing Algorithms</a>
								<a class="dropdown-item" href="#FSM">FSM Control UI</a>
								<a class="dropdown-item" href="#Flask">Flask Web Server</a>
								<a class="dropdown-item" href="#Servo Control">Servo Control</a>
							</div>
						</li>
						<li class="nav-item"><a class="nav-link" href="#Testing">Testing & Issues</a></li>
						<li class="nav-item"><a class="nav-link" href="#Result">Results</a></li>
						<li class="nav-item"><a class="nav-link" href="#conclusion">Future Work</a></li>
						<li class="nav-item"><a class="nav-link" href="#ref">Reference</a></li>
					</ul>
<!--					<ul class="nav navbar-nav navbar-right">-->
<!--                        <li><a class="hover-btn-new log orange" href="#" data-toggle="modal" data-target="#login"><span>Book Now</span></a></li>-->
<!--                    </ul>-->
				</div>
			</div>
		</nav>
	</header>
	<!-- End header -->
	
	<div id="carouselExampleControls" class="carousel slide bs-slider box-slider" data-ride="carousel" data-pause="hover" data-interval="false" >
		<!-- Indicators -->
		<ol class="carousel-indicators">
			<li data-target="#carouselExampleControls" data-slide-to="0" class="active"></li>
			<li data-target="#carouselExampleControls" data-slide-to="1"></li>
			<li data-target="#carouselExampleControls" data-slide-to="2"></li>
		</ol>
		<div class="carousel-inner" role="listbox">
			<div class="carousel-item active">
				<div id="home" class="first-section" style="background-image:url('images/wholeset.png');">
					<div class="dtab">
						<div class="container">
							<div class="row">
								<div class="col-md-12 col-sm-12 text-right">
									<div class="big-tagline">
										<h2><strong>Home Pi</strong> Security System</h2>
										<p class="lead"> ECE 5725 Final Project - by Jie He (jh2735) and Yuchong Geng (yg534).</br>
										December 19, 2020.
										</p>
<!--											<a href="#" class="hover-btn-new"><span>Contact Us</span></a>-->
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											<a href="#objective" class="hover-btn-new"><span>Read More</span></a>
									</div>
								</div>
							</div><!-- end row -->            
						</div><!-- end container -->
					</div>
				</div><!-- end section -->
			</div>
			<div class="carousel-item">
				<div id="home" class="first-section" style="background-image:url('images/projectPhoto.png');">
					<div class="dtab">
						<div class="container">
							<div class="row">
								<div class="col-md-12 col-sm-12 text-left">
									<div class="big-tagline">
										<h2 data-animation="animated zoomInRight">Home Pi <strong>Security System</strong></h2>
										<p class="lead" data-animation="animated fadeInLeft">A home security solution powered by deep learning, computer vision, and Android.  </p>
<!--											<a href="#" class="hover-btn-new"><span>Contact Us</span></a>-->
											&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											<a href="#objective" class="hover-btn-new"><span>Read More</span></a>
									</div>
								</div>
							</div><!-- end row -->            
						</div><!-- end container -->
					</div>
				</div><!-- end section -->
			</div>
			<div class="carousel-item">
				<div id="home" class="first-section" style="background-image:url('images/wholeset2.jpeg');">
					<div class="dtab">
						<div class="container">
							<div class="row">
								<div class="col-md-12 col-sm-12 text-right">
									<div class="big-tagline">
										<h2><strong>Home Pi</strong> Security System</h2>
										<p class="lead"> ECE 5725 Final Project - by Jie He (jh2735) and Yuchong Geng (yg534).</br>
											December 19, 2020.
										</p>
										<!--											<a href="#" class="hover-btn-new"><span>Contact Us</span></a>-->
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										<a href="#objective" class="hover-btn-new"><span>Read More</span></a>
									</div>
								</div>
							</div><!-- end row -->
						</div><!-- end container -->
					</div>
				</div><!-- end section -->
			</div>

			<a class="new-effect carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
				<span class="fa fa-angle-left" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			</a>

			<!-- Right Control -->
			<a class="new-effect carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
				<span class="fa fa-angle-right" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			</a>
		</div>
	</div>
	
    <div id="objective" class="section wb">
        <div class="container">
            <div class="section-title row text-center">
                <div class="col-md-8 offset-md-2">
                    <h3>Project Objective & Introduction</h3>
					<iframe width="560" height="315" src="https://www.youtube.com/embed/-fXKqDXpBbk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <p class="lead"> One day when Yuchong and Jie were discussing on what they planned to do for their ECE 5725 project, Jie's received a email from Cornell Alert reporting a home burglary where the criminal sneaked into a house. An idea popped in their minds： How about building a home security sytem to protect their homes and loved ones in it?
					</p>
					</br>
					<P class="lead">This system should be powerful enough so that Jie and Yuchong could watch the real time CCTV stream video and audio of their front doors from anywhere. Also, the system should be smart enough to automatically recognize their faces and open the doors while deny the faces of intruders. Even more, this system should enable remote control so that even if Yuchong forgets bringing the key, Jie still could open the door remotely while sitting at Phillips hall.
					</P>
					<img src="images/wholeset.png" alt="" class="img-fluid img-rounded">
					<P class="lead">Home Pi, our project, is a security system desgined for protecting the front doors of our home. This system streams live video and audio CCTV based on Picamera and Microphone to a webserver, which an android phone could access to. This system provides fast face recognition and real-time semantic segmentation based on Tensorflow and OpenCV powered by Coral TPU. An Android application should be able to access the system remotely.
					</P>

				</div>
            </div><!-- end title -->

			<div id="Design" class="all-title-box">
				<div class="container text-center">
					<h1>Design<span class="m_1"></span></h1>
				</div>
			</div>



			<div class="hmv-box">
				<div class="container">

					<center></center>
					<center>
						</br>
						</br>
						<p>
							Home Pi is a RPi embedded system apparatus consisting of a user interface, a android phone for remote control, a CCTV and its streaming server, a TPU and a webcam for smooth face recognition and a servo module for door control.
							Our system enable users to monitor the CCTV remotely via capturing video and audio through a Pi Cam and a microphone. The image and audio could be transmitted to a anrdoid phone, which could remotely control the system, via WiFi.
							Also, an extremely smooth face recogntion module powered by the powerful USE edge TPU enable face recognition and face registration.
						</p>
						</br>
						</br>
						</br>
					</center>

					<div class="row">
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href="#CCTV Server"><i class="flaticon-achievement"></i></a></div>
								<h3>CCTV Server</h3>
								<div class="tr-pa">M</div>
								<p>Our project has a CCTV server streams the live video and audio. The video is captured via a Picamera and the audio is collected via a microphone. The video and audio should be accessed via web browser and android application allowing users to access it conveniently. </p>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href=""><i class="flaticon-eye"></i></a></div>
								<h3>TPU & Face Recognition</h3>
								<div class="tr-pa">V</div>
								<p> To enable smooth user face login and fast face recognition,
									in our project, a USB Edge TPU, a tensor processing unit capable of accelerating machine learning tasks powered by Tensorflow, is integrated into our system.

								</p>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href="#android application"><i class="flaticon-history"></i></a></div>
								<h3>Android App</h3>
								<div class="tr-pa">H</div>
								<p>This system allows users to control it remotely via Android App. This android application should allow users to login via username and password. The authorized users could access live CCTV, the live semantic segmentation results and also control the door based on socket communication with the system.</p>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href="#Mutliprocessing Algorithms"><i class="flaticon-eye"></i></a></div>
								<h3>Multiprocessing Algorithms</h3>
								<div class="tr-pa">V</div>
								<p>In our project, the RPi has to perform tasks, including face recognition and semantic segementation, video and audio streaming, a multithreading UI, TCP socket communcation and a Flask web application at the same time. To reduce latency, we used Python multi processing to fully take advantage of four cores of RPi.  </p>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href=""><i class="flaticon-history"></i></a></div>
								<h3>FSM Control Interface</h3>
								<div class="tr-pa">V</div>
								<p>In this project, a user interface is implemented on PiTFT. To control the work flow of the GUI, a finite state machine is designed. This state machine helps the interface behave correspondingly based on the current state and given user inputs and performs state transitions. The FSM could also help the multithread algorithms perform correctly.</p>
							</div>
						</div>
						<div class="col-lg-4 col-md-6 col-12">
							<div class="inner-hmv">
								<div class="icon-box-hmv"><a href="#Flask"><i class="flaticon-achievement"></i></a></div>
								<h3>Flask-based Stream Server</h3>
								<div class="tr-pa">
									V
								</div>
								<p>Thanks to the powerful coral TPU, real-time semantic segmentation could be achieved in our project. To show the results, a web video server based on Flask was developed to stream the semantic segmentation results to a server, which could be accessed by Android App and web browser.</p>
							</div>
						</div>
					</div>
				</div>
			</div>



            <div class="row align-items-center">
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                    <div class="message-box">
						<h2 id="CCTV Server"> CCTV Server</h2>
                        <h4>Pi Camera Video Stream</h4>
<!--                        <h2>Welcome to SmartEDU education school</h2>-->
						<p>Pi camera was installed following this <a href="https://thepihut.com/blogs/raspberry-pi-tutorials/16021420-how-to-install-use-the-raspberry-pi-camera">tutorial</a>. First, install the Raspberry Pi Camera by inserting the cable into the Raspberry Pi camera port.
							Then we ran <code>sudo raspi-config</code> in the terminal to enable the camera. If the camera option is not available, then an update needs to be made, we run <code> sudo apt-get update</code> and <code> sudo apt-get upgrade</code> in this case. The Raspberry Pi needs to be rebooted.
							</br>
							To check if the picamera is successfully installed, we use camera to take photos <code> raspistill -o image.jpg</code> If we could view the image.jpg by running <code>gpicview image.jpg</code> without errors, the picamera is installed perfectly.
							</br>
							We consulted the official handbook <a href="https://picamera.readthedocs.io/en/release-1.13/recipes2.html#web-streaming">tutorial</a>  to make the RPi with Picamera as a video stream server. This is a simple HTTP server that achieves significantly higher frame rates than any solution else we tested (mjpg-streamer, Motion program, RPi-Cam-Web-Interface). The code we used could be found <a href="https://raw.githubusercontent.com/RuiSantosdotme/Random-Nerd-Tutorials/master/Projects/rpi_camera_surveillance_system.py"> here</a>.
							We set the live video feed to a website served by the RPi  <code>http:// IP_Address_Of_Pi:9000</code>. So, we could access the video streaming through web browser on a machine that is connected to the same LAN. The video stream could come with very little latency.

						</p>.

                    </div><!-- end messagebox -->
                </div><!-- end col -->

				<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
					<div class="post-media wow fadeIn">
						<img src="images/CCTV.png" alt="" class="img-fluid img-rounded">
					</div><!-- end media -->
				</div><!-- end col -->


				<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
					<div class="message-box">
						<h4>Pi Audio Stream</h4>
						<!--                        <h2>Welcome to SmartEDU education school</h2>-->
						<p>
							For audio stream, a USB microphone was used in our project. Once the microphone is plugged in, we load the audio module by typing <code>sudo modprobe snd_bcm2835</code>. And we check if we could use it properly by recording some audio into a file by running: <code>arecord -D plughw:1,0 test.wav</code>. And press <code>CTRL+C</code> when we’ve got enough recording.
							We play it to check if it works! <code>aplay test.wav</code>. Using the command <code>alsamixer</code>, we could record louder or adjust some parameter and play with the input/output levels of the microphone.
							</br>
							Similar to the video stream, it would be convenient if we stream the audio to a webserver to which the user could access via Android App or browsers.
							We followed the tutorial  <a href="https://maker.pro/raspberry-pi/projects/how-to-build-an-internet-radio-station-with-raspberry-pi-darkice-and-icecast">tutorial</a> here to make our RPi an Internet radio station to record or play your podcasts.
						</p>

					</div><!-- end messagebox -->
				</div><!-- end col -->

				<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
					<div class="message-box">
						<!--						<h4>Pi Camera Video Stream</h4>-->
						<!--                        <h2>Welcome to SmartEDU education school</h2>-->
						<p> We set up the streaming station using two packages called <a href="http://www.darkice.org/">DarkIce</a>, a live audio streamer, and <a href="https://icecast.org/"> Icecast</a> an audio/video streaming media server. The detail of how to install Darkice and Icecast could be found <a href="https://maker.pro/raspberry-pi/projects/how-to-build-an-internet-radio-station-with-raspberry-pi-darkice-and-icecast">here</a>.
							</br>
							After the Icecast2 installation, we made a Config file for DarkIce by creating a file named <code>darkice.cfg</code>. The content configurations file should be like xxx and we also need to make shell script named <code>darkice.sh</code> so we could start the audio stream service by executing it. After entering <code>sudo service icecast2 start</code>, we could launch the audio stream server by executing the shell script <code>sudo /home/pi/darkice.sh</code>. And we set We set the live audio feed to a website served by the RPi, and the audio could be accessed by visiting the url <code>http:// IP_Address_Of_Pi:8000/rapi.mp3</code> on browser.
						</p>.
						<a href="https://github.com/stephen-hjay/Home_Pi/blob/main/final_project_RPi/CCTVServer.py" class="hover-btn-new orange"><span>Github Repo</span></a>
					</div><!-- end messagebox -->

				</div><!-- end col -->
        </div><!-- end container -->
    </div><!-- end section -->



		<div id="TPU" class="section wb">
			<div class="container">
				<div class="section-title row text-center">
					<div class="col-md-8 offset-md-2">
						<h3 >TPU-Based Face Recognition</h3>
						<p class="lead">

							Our system will first run semantic segmentation to obtain the area of interest (ROI) that are related to people.
							Then, the ROI will be put into a classification model to determine whether the current user is registered. The classification results will be sent to the UI via message queue and to determine whether to open the door.
						</p>
					</div>
				</div><!-- end title -->

				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
<!--							<h4>2020 BEST SmartEDU education school</h4>-->
<!--							<h2>Welcome to SmartEDU education school</h2>-->
							<p>The main benefit of TPU is that we could achieve real-time recognition speed.
								Even though Raspberry Pi 4B comes with a GPU, this GPU is designed for more general tasks of graphic processing but not specifically designed for tensor processing tasks.
								Thus, with this Edge USB TPU, the computation performance of a Raspberry Pi on tensor processing tasks is greatly boosted. </p>

							<p>

								Sampling video as dataset, the inference time of the classification for each frame in the video is recorded.
								Then, we plot the recorded inference times on a bar graph, with y-axis being the inference time in milliseconds which is shown on the comparison between inference times on CPU and TPU, there is a huge difference for TPU and CPU.
								The inference times for TPU are all below 20 milliseconds with average around 10 milliseconds.
								These numbers translate to a frame rate of 100 frames per second, which is a lot bigger than most cameras’ frame rate which is usually 30 or 60 fps.
								As for the CPU, the average inference time lies below 80 milliseconds, which corresponds to just 12.5 frames per second.
								So using TPU can greatly improve our system’s response time.


							</p>

						</div><!-- end messagebox -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/inference.png" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->
				</div>
				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/lostfunction.png" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
<!--							<h2>The standard Lorem Ipsum passage, used since the 1500s</h2>-->
							<p>
								Another benefit of using TPU is it can retrain a model on-device very quickly.
								This feature allows new users to register their faces into the system and at the next boot, our program can retrain the classification model very quickly.
								For our experiment, re-training on 300 images for around 300 iterations only takes 2 to 3 seconds, and the accuracy of the re-trained model is also very high.
								In figure 2, we have shown the accuracy and loss over 300 iterations.
								As shown in the figure, the model quickly learns the images and reach a plateau very early.

							</p>

							<p> Integer rutrum ligula eu dignissim laoreet. Pellentesque venenatis nibh sed tellus faucibus bibendum.</p>


						</div><!-- end messagebox -->
					</div><!-- end col -->

				</div><!-- end row -->


				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
							<!--							<h4>2020 BEST SmartEDU education school</h4>-->
							<!--							<h2>Welcome to SmartEDU education school</h2>-->
							<p>And to illustrate our model’s performance, we have also plotted the confusion matrix for test images.
								As shown in this confusion matrix, the model can clearly differentiate between Yuchong, Jay and negative.
							</p>
							<a href="https://github.com/stephen-hjay/Home_Pi/blob/main/final_project_RPi/video_stream.py" class="hover-btn-new orange"><span>Github Repo</span></a>
						</div><!-- end messagebox -->

					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/confusion.png" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->
				</div>

			</div><!-- end container -->
		</div><!-- end section -->



		<div class="section lb page-section">
			<div class="container">
				<div class="message-box">
				<h2 id="android application">Android Application</h2>

				<h4>Video and Audio Stream on APP</h4>
				<p>After setting up the live stream video and audio station on RPi, we need to display the video on the Android phone by using WebView in App's MainActivity.</p>

				<pre style='box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 13px; display: block; padding: 9.5px; margin: 0px 0px 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: -webkit-left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;'><code style='box-sizing: border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-radius: 0px; white-space: pre-wrap;'>public class MainActivity extends AppCompatActivity implements SensorEventListener {
        private WebView webview ;
        ...
        @Override
        protected void onCreate (Bundle savedInstanceState) {
        ...
        webview =(WebView)findViewById(R.id.webView);
	// make the webview adapt to the screen
        WebSettings settings = webView.getSettings();
        settings.setUseWideViewPort(true);
        settings.setLoadWithOverviewMode(true);
	// display the video
        webview.setWebViewClient(new WebViewClient());
        webview.getSettings().setJavaScriptEnabled(true);
        webview.getSettings().setDomStorageEnabled(true);
        webview.setOverScrollMode(WebView.OVER_SCROLL_NEVER);
        webview.loadUrl("http://ip_address_of_Rpi:9000");

       }
 }</code></pre>

				<p>But WebView only could not play the audio, to get the real-time audio streaming, we still need to include a MediaPlayer in our Android to play the sound from the audio server.</p>
				<pre style='box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 13px; display: block; padding: 9.5px; margin: 0px 0px 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: -webkit-left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;'><code style='box-sizing: border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-radius: 0px; white-space: pre-wrap;'>
	MediaPlayer mediaPlayer = new MediaPlayer();
        mediaPlayer.setAudioAttributes(
                new AudioAttributes.Builder()
                        .setContentType(AudioAttributes.CONTENT_TYPE_MUSIC)
                        .setUsage(AudioAttributes.USAGE_MEDIA)
                        .build()
        );
        try {
            mediaPlayer.setDataSource("http://ip_address_of_Rpi:8000/rapi.mp3");// the url for the sound data source
            mediaPlayer.prepare();
        } catch (IOException e) {
            e.printStackTrace();
        }
        //  might take long! (for buffering, etc)
        mediaPlayer.start();
 </code></pre>

				</div>

				<div class="message-box">
					<h4>TCP SOCKET COMMUNICATION (Application End)</h4>
					<p>In our project, we have "Admin Login" section in our interface. When entering this module, the UI would ask the user (the admins or the app holders) to login by entering password and username on the APP. After a successgul login, the UI (PiTFT) would display the username of the user who have logged in the system. And the user who has successfully logged in should have the right to open the door and watch the CCTV live.
						Thus, a TCP socket communication module should also be deployed on both the Android APP and RPi server end. The following code is </p>

					<pre style='box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 13px; display: block; padding: 9.5px; margin: 0px 0px 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: -webkit-left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;'><code style='box-sizing: border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-radius: 0px; white-space: pre-wrap;'>class Sender extends AsyncTask {
        Socket s;// socket connected to RPi
        PrintWriter pw;
        String msg;
        String type;
        BufferedReader bufferedReader;
        @SuppressLint("SetTextI18n")
        @Override
        protected Void doInBackground(Void...params){
            try {
                s = new Socket("ip address of RPi", 7000);
			// send message to RPi Server
                pw = new PrintWriter(s.getOutputStream());
                pw.write(msg);
                pw.flush();
                bufferedReader = new BufferedReader(new InputStreamReader(s.getInputStream()));
			// receive message from RPi Server
                String msg2 = bufferedReader.readLine();

                switch (type) {
                    case "login":
                        if (msg2!=null && msg2.equals("Success")) {
                            success = true;
						// login successfully
                            statusTextView.setText("Login Success");
                           showToast("Login Success");
                        }else{
						// login fail
                            statusTextView.setText("Not Login In");
                            showToast("Login Fail");
                        }
                        break;
                    case "doorOpen":
                        if (msg2!=null && msg2.equals("Success")) {
                            doorOpen = true;
                            doorStatusTextView.setText("Door Open");
                        }
                }

             ....
        }
    }
 </code></pre>



				</div>

				<div class="message-box">

					<h4>User Login Activity</h4>
					<p> Before allowing the user to see the CCTV live stream and control our system, a login activity must be passed to verify the user identity. Thus, a user login activity was first launched on our App. The login activity would allow users to fill in the username, password, IP address of RPi, and the designated port number.
						 </p>

					<pre style='box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 13px; display: block; padding: 9.5px; margin: 0px 0px 10px; line-height: 1.42857; color: rgb(51, 51, 51); word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-radius: 4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: -webkit-left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;'><code style='box-sizing: border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-radius: 0px; white-space: pre-wrap;'>public class StartActivity extends AppCompatActivity {

	private EditText textViewUserName;
    private EditText textViewPassword;
	...

    @Override
    protected void onCreate(Bundle savedInstanceState) {
	....
	// login button
        Button buttonEnter = (Button) findViewById(R.id.enter);
        buttonEnter.setOnClickListener(

                (x) -> {
                    uName = textViewUserName.getText().toString();
                    pwd = textViewPassword.getText().toString();
                    host = textViewIP.getText().toString();
                    TCPport = Integer.valueOf(textViewPort.getText().toString());

                    if (uName == null || uName.length() == 0 || pwd == null || pwd.length() == 0) {
                        showToast("please fill all blanks");
                        return;
                    }else{
                        StartActivity.Sender sender = new  StartActivity.Sender();
                        sender.host = host;
                        sender.port = TCPport;
                        sender.msg = "Check:"+uName+":"+pwd;
                        sender.type = "login";
                        sender.execute();
                        long timeInit = System.currentTimeMillis();

			// wait for the login result from server
                        while(System.currentTimeMillis() - timeInit<3000){
                            if (success){
                                Intent startMainActivityIntent = new Intent(StartActivity.this, MainActivity.class);
                                startActivity(startMainActivityIntent);
                                finish();
                            }
                        }
                    }
                });

 </code></pre>



				</div>

		</div>
		</div>
		</section>

		<div id="overviews" class="section wb">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">

							<h2 id="Mutliprocessing Algorithms"> Mutliprocessing Algorithms</h2>
							<p>To achieve our goal of live video and audio streaming, face recognition, semantic segementation and flask stream, we must decrease the latency and running time of every part as fast as possible. At the beginning, we tried to launch every thing in one bash file. This delay time and the latency is too long. To reduce the latency, one solution is to parallel process different tasks to take advantage of four cores in R-Pi.
								In python, we could use the multiprocessing library to fully take advantage of four cores of R-Pi. In total, we have five process assigned to four cores.
							</p>
							<a href="#main interface" class="hover-btn-new orange"><span>Learn More</span></a>
						</div><!-- end messagebox -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
<!--							<h2>The standard Lorem Ipsum passage, used since the 1500s</h2>-->

							<ol>
							<li>The first core is assgined to stream the video and audio for the CCTV. Since we do not need the feedback from CCTV to control our state machine, we do not need to pass a queue into this process for interprocess communication. Even more, this core is assigned to a Flask Web application process, which is consumer process consuming the frames generated by sementic segmentation process. Thus, a <code>frame_queue</code> is passed into it to received processed semantic segmentation frames from the face recognition module.  </li>

							<li> The second core is assgined to launch the TCP socket server to receives socket connection and communicates with Android APP. For the user login module, the main interface needs user login information and display the login user. Thus,this is a producer process producing TCP connection results and the <code>login_queue</code> is passed into for processing communication.  	</li>

							<li>
								The third core is assigned to launch the face registration and face recognition module. By assigning a core to this computation-heavy module, the system could achieve higher frame per second and also receive face recognition result in only 20 ms. For this module, this is a producer process producing face recognition results and semantic segmentation frames. Thus, a <code>face_recognition_queue</code> for passing recognition results and a <code>frame_queue</code> for sending frames to Flask server were passed into.
							</li>

							<li>
								The forth core is used to launch the main user interface. This UI screen is refreshed every 0.02 second, several GPIO callback and several threads were running at the same time so it needs the multiprocessing algorithm to ensure the UI smooth response. This is a consumer process, this process receives the face recognition results and the login results from other processes. Thus, the <code>face_recognition_queue</code> and <code>login_queue</code> were passed into to allow the UI get the results from APP login and face recognition.
							</li>

						</ol>


						</div><!-- end messagebox -->
					</div><!-- end col -->

					<p>
						The above describes the tasks that every core executes. But we still need to figure out how each process could communicate with each other via queues. In our project, the producer processes produce the results and frames. If the producer ceasely put results into the queue, unexpected results would appear.
						For exmaple, if the face recognition module continuously feeds results into the queue and the UI only asks for results occasionally, the recognition results would be piled up in the queue. The next time when the UI requests the request, it could only get = the outdated piled up results from the front of the queue since queue is First-In-First-Out.
						In order to resolve this problems, we have two solutions: 1. the producers examines the status of the message queue and clear the outdated results; 2. use LIFO (Last-In-First-Out) queue so that the consumer could always get the newest results.
						</br>
						After weighing the pros and cons, we decided to take the first option that the producers clear the outdated results in time since it hep could lower the burden on the system memory and resources. This is a classic producer-consumer design pattern where queue serves as the message pipe and the cache, and the producer process needs to match the speed of the consumer process.

					</p>

				</div><!-- end row -->
			</div><!-- end container -->
		</div><!-- end section -->






		<div class="section lb page-section">
			<div class="container">
				<div class="message-box">
					<h2 id="FSM">FSM Control User Interface</h2>

					<p>
					In our project, apart from multiprocessing, the user interface and the system need to process several complex tasks at the same time.
						A finite state machine is designed to control the logic of multi thread activities and all functional modules. The user interface would behave accordingly given user inputs and performs state transitions.
					</p>

					<ol>
						<li>
							When system starts, the system would first assgin cores to each modules, and initialize the message queue for process communication. Then the state machine would enter the MAIN state where the main interface is displayed.
							When user input is given (For example, the user chooses "Admin Login", "Face Login" or "Face Registration"), the state machine would transit to the corresponding state.
						</li>
						<li>
							When state machine in "Admin Login" function, the state machine would start a new thread trying to get user login results from TCP module modules via message queue.
							When the state machine receives positive results, the state machine would transit to "User Welcome" and will then return to "MAIN" state.
						</li>

						<li>
							When state machine in "Face Login" function, the state machine would start a new thread trying to get results from Face Recognition module modules via message queue.
							When user press "Confirm", the state machine would shift to "Check" and will decide if open the door based on recognition results. If it is the intended users, a new thread would be started to open the door asynchronously.
						</li>

						<li>
							When state machine in "Face Registration" function, the state machine would start a new thread to call a bash shell script taking photos of the faces of users and save them to a designated location.
							When this process finish, the state machine would return to "FINISH" and then "MAIN" automatically.
						</li>

					</ol>

				</div>
				<div class="post-media1 wow fadeIn">
					<center><img id="FSMPic" src="images/FSM.jpg" alt=""  ></center>
				</div><!-- end media -->
			</div>
		</div>
		</section>



		<div id="Flask" class="section wb">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
<!--							<h4>2020 BEST SmartEDU education school</h4>-->
							<h2>Flask based Semantic Segmentation Result Streaming Server</h2>
							<p>Thanks to the powerful coral TPU, real-time semantic segmentation could be achieved in our project.
								Thus, in order to get more intuitive results of the face recognition module, we decided to stream the semantic segmemantation results.
								We evaluated several solutions:</p>

							<ol>
								<li>
									TCP socket image transfer, but we need to view it through VNC, which is not very ideal in our project, since we do not want to ssh login the RPi when system is running.						</li>
								</li>
								<li>RPi-Cam-Web-Interface and mjpg-streamer allows for high frame rate realtime image transfer, but don’t allow for customization
								</li>

								<li>
									Django could be ideal but it is too heavy for our project, since we do not need to process complex requests.

								</li>

							</ol>
<!--							<a href="#" class="hover-btn-new orange"><span>Learn More</span></a>-->
							At last, we settled on <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a>, which is a lightweight Python web backend framework. Then, a web video server based on Flask was developed to stream the semantic segmentation results to a server, which could be accessed by Android App and web browser.
						</div><!-- end messagebox -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/1200px-Flask_logo.svg.png" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->
				</div>


				<!-- end row -->
			</div><!-- end container -->
		</div><!-- end section -->



	    <section class="section lb page-section">
		<div class="container">
			 <div class="section-title row text-center">
                <div class="col-md-8 offset-md-2">
                    <h3 id="Testing"> Testing & Issues</h3>
                    <p class="lead"> In our project, we have tracked issues we met based on timeline. The below is a timeline recording the issues we discovered in our project and also the way how we resolve those problems.


					</p>
                </div>
            </div><!-- end title -->
			<div class="timeline">
				<div class="timeline__wrap">
					<div class="timeline__items">
<!--						<h3 id="Issues">Issues</h3>-->
						<div class="timeline__item">
							<div class="timeline__content img-bg-01">
								<h2>Broken Pi Cam</h2>
								<p>
									At first, we have tested every hardware we have got in our project. And we have found out that the PiCam turned out to be a little fragile.
								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-02">
								<h2>Python Module Installation</h2>
								<p>
									For the installation of python modules, since the Raspibian system, we need to pay special attention to users and python version. In our project, we launch our programs with <code>sudo python3</code>. Thus, we need to use <code>sudo pip3 install</code> to make sure every module is installed under super user and Python3.
								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-03">
								<h2>Multiprocessing Communication</h2>
								<p>
									Since mutliprocesses need to communicate with each other, we have researched on several solutions of multiprocessing communication, such as FIFO, Queue. We decided to use Queue and implement the multiprocessing algorithms, since there would be no need to interact with OS frequently thus to increase the efficiency.
								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-04">
								<h2>Multiple Camera Conflicts</h2>
								<p>
									In our project, we used two cameras. However, the camera index is randomly assigned but OpenCV requires the specific number of WebCam is assigned to.
									In order to avoid this randomness, we have designed a method to confirm the number which is assigned to web cam using commands <code>v4l2-ctl -d /dev/videoN -D</code>

								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-01">
								<h2>Clear Text not permitted in Android</h2>
								<p>
									When we developed android application viewing the live CCTV, the communication protocol is based on HTTP which is unsecured and not permitted in Android 8.
									Also, we also need to configure Internet before launching the App. Thus, we need to include <code>android:usesCleartextTraffic="true"</code> and <code> <uses-permission android:name="android.permission.INTERNET"/></code> in the <code>AndroidManifest.xml</code> file.

								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-02">
								<h2>Internet Conncetion when Initializing</h2>
								<p>
									Since our project highly relies on Internet connection, we have included a piece of shell script code to ensure Pi has connected to Wifi before launching the main program.
								</p>
							</div>
						</div>
						<div class="timeline__item">
							<div class="timeline__content img-bg-03">
								<h2>Servo Issues</h2>
								<p>
									For this project, we also use a continuous rotation servo to control a door.
									However, the servo is not calibrated and it continues to rotate at a slow speed when given a stop signal.
									To solve it, by looking through the servo’s datasheet, we found that we can calibrate the servo by adjusting the potentiometer.
									So we calibrated the servo by giving a stop signal and trying to find the position that the servo moves the least.
								</p>
							</div>
						</div>

						<div class="timeline__item">
							<div class="timeline__content img-bg-04">
								<h2>Memory Allocation</h2>
								<p> The on-board GPU on Pi may have run out of memory space since we used multiple cameras. Upon investigation, we have found that Pi actually allows users to determine the memory allocation to GPU. We have increased default memory 128 MB  to 256 MB.
								</p>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</section>



    <div id="testimonials" class="parallax section db parallax-off" style="background-image:url('images/wholeset.png');">
        <div class="container">
            <div class="section-title text-center">
                <h3>Test Videos</h3>
                <p>We followed an incremental testing approach in our development.
					This enabled our team to parallelize our work seperately, while ensuring each individual of us develop fully functional component before being integrated into the system-at-large. The below videos records how we test each module, and integrate them into a system.
				</p>
			</div><!-- end title -->

            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="testi-carousel owl-carousel owl-theme">
                        <div class="testimonial clearfix">
							<div class="testi-meta">
<!--                                <img src="images/testi_01.png" alt="" class="img-fluid">-->
                                <h4>Face Recognition & Segmentation Results </h4>
                            </div>
<!--                            <div class="desc">-->
<!--                                <h3><i class="fa fa-quote-left"></i> Wonderful Support!</h3>-->
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/cJcruITofGU" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<!--                            </div>-->
                            <!-- end testi-meta -->
                        </div>
                        <!-- end testimonial -->

                        <div class="testimonial clearfix">
							<div class="testi-meta">
<!--                                <img src="images/testi_02.png" alt="" class="img-fluid">-->
                                <h4>User Interface Test </h4>
                            </div>
							<iframe width="560" height="315" src="https://www.youtube.com/embed/13xrsHnUF_U" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            <!-- end testi-meta -->
                        </div>
                        <!-- end testimonial -->

                        <div class="testimonial clearfix">
							<div class="testi-meta">
                                <h4> Android Phone Test</h4>
                            </div>
							<iframe width="560" height="315" src="https://www.youtube.com/embed/Tg_YHVRKXuQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            <!-- end testi-meta -->
                        </div>
                        <!-- end testimonial -->
                        <div class="testimonial clearfix">
							<div class="testi-meta">
<!--                                <img src="images/testi_01.png" alt="" class="img-fluid">-->
                                <h4>CCTV Test on Android and Browser </h4>
                            </div>
<!--                            <div class="desc">-->
<!--                                <h3><i class="fa fa-quote-left"></i> Wonderful Support!</h3>-->
<!--                                <p class="lead">They have got my project on time with the competition with a sed highly skilled, and experienced & professional team.</p>-->
<!--                            </div>-->
							<iframe width="560" height="315" src="https://www.youtube.com/embed/LEgcQkHB0gc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            <!-- end testi-meta -->
                        </div>

                    </div><!-- end carousel -->
                </div><!-- end col -->
            </div><!-- end row -->
        </div><!-- end container -->
    </div><!-- end section -->






		<div id="teachers" class="section wb">
			<div class="container">
				<h2 >About Us</h2>
				<div class="row">
					<div class="col-lg-3 col-md-6 col-12">
						<div class="our-team">
							<div class="team-img">
								<img src="images/jay.jpeg">
								<div class="social">
									<ul>
										<li><a href="#" class="fa fa-facebook"></a></li>
										<li><a href="#" class="fa fa-twitter"></a></li>
										<li><a href="#" class="fa fa-linkedin"></a></li>
										<li><a href="#" class="fa fa-skype"></a></li>
									</ul>
								</div>
							</div>
							<div class="team-content">
								<h3 class="title">Jie He (jh2735)</h3>
								<span class="post">Android, CCTV, User Interface, Multiprocessing Algorithm, Flask, Website</span>
							</div>
						</div>
					</div>

					<div class="col-lg-3 col-md-6 col-12">
						<div class="our-team">
							<div class="team-img">
								<img src="images/yuchong.jpeg">
								<div class="social">
									<ul>
										<li><a href="#" class="fa fa-facebook"></a></li>
										<li><a href="#" class="fa fa-twitter"></a></li>
										<li><a href="#" class="fa fa-linkedin"></a></li>
										<li><a href="#" class="fa fa-skype"></a></li>
									</ul>
								</div>
							</div>
							<div class="team-content">
								<h3 class="title">Yuchong Geng (yg534)</h3>
								<span class="post">Servo Control, Face Recognition, Semantic Segmentation, TPU</span>
							</div>
						</div>
					</div>


					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/team.png" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->



				</div><!-- end row -->
			</div><!-- end container -->
		</div><!-- end section -->



		<div class="section lb page-section" id="Result">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div id="conclusion" class="message-box">
							<!--							<h4>2020 BEST SmartEDU education school</h4>-->
							<h2>Result & Conclusion</h2>
							<p>
								For this assignment we have successfully designed and implemented a Smart Home Entry system.
								We have used many different tools and techniques to build our system including but not limited to Android Studio, Flask, TPU, multi-processing, TCP/IP socket, FSM and etc.
								And we think our system performs well as we expected. We can also further improve our face recognition module by using diverse images to train our model.
								After implementing this system and spending many times on debugging errors we have made, we have grabbed a lot of knowledge about embedded systems that cannot be learned just by studying textbooks.
								And we want to use this opportunity to thank our amazing instructor Joseph Skovira and dedicated TAs for their generous support, detailed guidance and great passion into this course.
							</p>
							<a href="https://github.com/stephen-hjay/Home_Pi" class="hover-btn-new orange"><span>Github Repo</span></a>

							<h2>Future Work</h2>

							<p>
								Even though we have achieved all of the functions that we have designed, we do think that there are many places for improvement. And they are divided into three parts: network latency, UI design and diverse dataset for our classification model.

								Network latency is a main factor that affects our system’s user experience. Our system streams two videos into the network at the same time and they may suffer from high latency and thus are not able to generate smooth and stable streams. We think there are some ways to solve this problem. For example, a resolution adjuster can be implemented so when the system senses a high latency, it will automatically reduce the video resolution.

								Another improvement can be made on our UI design. Specifically, we have two places that have UI interfaces, the PiTFT display screen and our Android App. When we were designing the system, our top priority was to make sure all the codes work perfectly, so we did not have many UI designs on our Apps and display screen. We think a more user friendly interface would make our system more attractive.

								Lastly, we think we can further improve our classification model’s performance by re-training it on a more diverse dataset. Currently, our dataset only contains Yuchong and Jay’s images as well as their rooms’ images, so we think our model’s great performance can only be realized at our rooms. A more diverse dataset can make sure our model has a “global” understanding of its task.


							</p>
							<!--							<a href="#" class="hover-btn-new orange"><span>Learn More</span></a>-->
													</div><!-- end messagebox -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="post-media wow fadeIn">
							<img src="images/wholeset2.jpeg" alt="" class="img-fluid img-rounded">
						</div><!-- end media -->
					</div><!-- end col -->
				</div>



		<div id="Parts List & Reference" class="section wb">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
							<!--							<h4>2020 BEST SmartEDU education school</h4>-->
							<h2>Parts List</h2>
							<ul>
								<li><a href="https://www.amazon.com/Raspberry-Pi-Camera-Module-Megapixel/dp/B01ER2SKFS">Raspberry Pi Camera V2 $25.00</a></li>
								<li><a href="https://www.amazon.com/eBerry-Microphone-Adjustable-Compatible-Recording/dp/B00UZY2YQE">Microphone $8</a></li>
								<li>Android Phone - from student's MEng Project </li>
								<li>TPU - from student's MEng Project </li>
								<li><a href="https://www.amazon.com/Streaming-Business-Microphone-AutoFocus-NexiGo/dp/B08BY1JWHG/ref=sr_1_2_sspa?crid=ZINNGVH1O9Z3&dchild=1&keywords=logitech+webcam&qid=1608438070&sprefix=logitech+%2Caps%2C170&sr=8-2-spons&psc=1&smid=A1HNC035CZ2MR5&spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEzRUgySTk2R002U1pPJmVuY3J5cHRlZElkPUEwMTY1NDc2M0JFRkI3NktYTjlaMSZlbmNyeXB0ZWRBZElkPUEwODkxMjk0Mlc3WkZTTDdKTkZRUCZ3aWRnZXROYW1lPXNwX2F0ZiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">Logitech WebCam - from student's</a> </li>
								<li>Raspberry Pi, Resistors, Wires, Servo,- Provided in lab</li>
							</ul>
							<h3>Total: $33</h3>
						</div><!-- end messagebox -->
					</div><!-- end col -->

					<div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
						<div class="message-box">
							<!--							<h4>2020 BEST SmartEDU education school</h4>-->
							<h2 id = "ref">References</h2>
							<ul>
								<li><a href="https://picamera.readthedocs.io/en/release-1.13/">PiCamera Documentation</a></li>
								<li><a href="https://sourceforge.net/p/raspberry-gpio-python/wiki/Home/">RPi GPIO Library</a></li>
								<li><a href="https://github.com/NakulLakhotia/Live-Streaming-using-OpenCV-Flask/blob/main/app.py">Flask Web Stream</a> </li>
								<li><a href="https://realpython.com/python-sockets/">Python Socket Programming</a> </li>
								<li><a href="https://maker.pro/raspberry-pi/projects/how-to-build-an-internet-radio-station-with-raspberry-pi-darkice-and-icecast">Radio Station based on Pi</a> </li>
								<li><a href="https://media.digikey.com/pdf/data%20sheets/adafruit%20pdfs/154_web.pdf">Servo Datasheet</a></li>
								<li><a href="https://www.tensorflow.org/lite">Tensorflow Lite Official Documentation</a></li>
								<li><a href="https://coral.ai/docs/">Coral TPU Documentation</a></li>

							</ul>
						</div><!-- end messagebox -->
					</div><!-- end col -->
				</div>


				<!-- end row -->
			</div><!-- end container -->
		</div><!-- end section -->



		<!--		<div class="parallax section dbcolor">-->
<!--    </div>&lt;!&ndash; end section &ndash;&gt;-->

    <footer class="footer">
        <div class="container">
			<h1 id="code">Code Appendix</h1>



			<h2 id = "main interface">main system</h2>
			<p>
				<meta charset="utf-8"><code style='box-sizing: border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: inherit; padding: 0px; color: inherit; background-color: transparent; border-radius: 0px; white-space: pre-wrap;'>&nbsp;</code></p>
			<style type="text/css">
				p.p1 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #6c7986;
					background-color: #1f1f24
				}
			</style>
			<p class="p1">###################################</p>
			<p class="p1">### author: Jie He and Yu Chong###</p>
			<p class="p1">### Date: Dec 19 2020 ############</p>
			<p class="p1">##################################</p>
			<style type="text/css">
				p.p1 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #ffffff;
					color: rgba(255, 255, 255, 0.85);
					background-color: #1f1f24
				}

				p.p2 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #fc5fa3;
					background-color: #1f1f24
				}

				p.p3 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #ffffff;
					color: rgba(255, 255, 255, 0.85);
					background-color: #1f1f24;
					min-height: 14.0px
				}

				p.p4 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #6c7986;
					background-color: #1f1f24
				}

				p.p5 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #d0bf69;
					background-color: #1f1f24
				}

				p.p6 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #fc6a5d;
					background-color: #1f1f24
				}

				span.s1 {
					color: #fc5fa3
				}

				span.s2 {
					color: rgba(255, 255, 255, 0.85)
				}

				span.s3 {
					color: #6c7986
				}

				span.s4 {
					color: #d0bf69
				}

				span.s5 {
					color: #fc6a5d
				}
			</style>
			<p class="p1"><span class="s1"><strong>import</strong></span> pygame</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pygame.locals <span class="s1"><strong>import</strong></span> MOUSEBUTTONDOWN, MOUSEBUTTONUP</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;os</span></p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;time</span></p>
			<p class="p1"><span class="s1"><strong>import</strong></span> numpy <span class="s1"><strong>as</strong></span> np</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> RPi.GPIO <span class="s1"><strong>as</strong></span> GPIO</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> traceback</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> threading</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> multiprocessing <span class="s1"><strong>import</strong></span> Process, Queue</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> subprocess <span class="s1"><strong>import</strong></span> call</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> subprocess</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> socket</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;time</span></p>
			<p class="p1"><span class="s1"><strong>from</strong></span> threading <span class="s1"><strong>import</strong></span> Thread</p>
			<p class="p1"><span class="s1"><strong>import</strong></span> base64</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;cv2</span></p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;zmq</span></p>
			<p class="p1"><span class="s1"><strong>from</strong></span> video_stream <span class="s1"><strong>import</strong></span> Classify_and_Stream</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> servoControl <span class="s1"><strong>import</strong></span> ServoControl</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;os</span></p>
			<p class="p1"><span class="s1"><strong>from</strong></span> flask <span class="s1"><strong>import</strong></span> Flask, render_template, Response</p>
			<p class="p3"><br></p>
			<p class="p1">app = Flask(__name__)</p>
			<p class="p3"><br></p>
			<p class="p4"># Display on piTFT</p>
			<p class="p4"># need sudo ti be effective</p>
			<p class="p5"><span class="s2">os.putenv(</span>&apos;SDL_VIDEODRIVER&apos;<span class="s2">,&nbsp;</span>&apos;fbcon&apos;<span class="s2">)</span></p>
			<p class="p5"><span class="s2">os.putenv(</span>&apos;SDL_FBDEV&apos;<span class="s2">,&nbsp;</span>&apos;/dev/fb1&apos;<span class="s2">)</span></p>
			<p class="p3"><br></p>
			<p class="p4"># Track mouse clicks on piTFT</p>
			<p class="p5"><span class="s2">os.putenv(</span>&apos;SDL_MOUSEDRV&apos;<span class="s2">,&nbsp;</span>&apos;TSLIB&apos;<span class="s2">)</span></p>
			<p class="p5"><span class="s2">os.putenv(</span>&apos;SDL_MOUSEDEV&apos;<span class="s2">,&nbsp;</span>&apos;/dev/input/touchscreen&apos;<span class="s2">)</span></p>
			<p class="p3"><br></p>
			<p class="p1">GPIO.setmode(GPIO.BCM)<span class="Apple-converted-space">&nbsp;&nbsp;</span><span class="s3"># Use broadcom numbering</span></p>
			<p class="p4"># Setup two output pins</p>
			<p class="p1"><span class="s1"><strong>global</strong></span> state, success</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>global</strong></span> systemOn</p>
			<p class="p1">systemOn = <span class="s1"><strong>True</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>global</strong></span> detected</p>
			<p class="p1">detected = <span class="s1"><strong>False</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>global</strong></span> prediction</p>
			<p class="p1">prediction = <span class="s4">&apos;&apos;</span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>global</strong></span> frameQueue</p>
			<p class="p1">frameQueue = Queue()</p>
			<p class="p3"><br></p>
			<p class="p4"># for flask semantic segmentation stream</p>
			<p class="p4"><span class="s1"><strong>def</strong></span><span class="s2">&nbsp;gen_frames(frameQueue:Queue):<span class="Apple-converted-space">&nbsp;&nbsp;</span></span># generate frame by frame from camera</p>
			<p class="p2"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span><strong>while</strong><span class="s2">&nbsp;</span><strong>True</strong><span class="s2">:</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Capture frame-by-frame</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#frame = frameQueue.get(True) # read the camera frame</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> frameQueue.empty():</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>frame = frameQueue.get(<span class="s1"><strong>True</strong></span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>ret, buffer = cv2.imencode(<span class="s4">&apos;.jpg&apos;</span>, frame)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>frame = buffer.tobytes()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>yield</strong></span> (b<span class="s4">&apos;--frame\r\n&apos;</span></p>
			<p class="p5"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>b</span>&apos;Content-Type: image/jpeg\r\n\r\n&apos;<span class="s2">&nbsp;+ frame + b</span>&apos;\r\n&apos;<span class="s2">)</span></p>
			<p class="p3"><br></p>
			<p class="p5"><span class="s2">@app.route(</span>&apos;/video_feed&apos;<span class="s2">)</span></p>
			<p class="p1"><span class="s1"><strong>def</strong></span> video_feed():</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> frameQueue</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span>#Video streaming route. Put this in the src attribute of an img tag</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> Response(gen_frames(frameQueue), mimetype=<span class="s4">&apos;multipart/x-mixed-replace; boundary=frame&apos;</span>)</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1">@app.route(<span class="s4">&apos;/&apos;</span>)</p>
			<p class="p1"><span class="s1"><strong>def</strong></span> index():</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span>&quot;&quot;&quot;Video streaming home page.&quot;&quot;&quot;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> render_template(<span class="s4">&apos;index.html&apos;</span>)</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>def</strong></span> init_CCTV_video_audio():</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>call(</span>&quot;sudo bash /home/pi/final_project/init_video_audio&quot;<span class="s2">, shell=</span><span class="s1"><strong>True</strong></span><span class="s2">)</span></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>def</strong></span> getLocalIp():</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span>&apos;&apos;&apos;Get the local ip&apos;&apos;&apos;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>try</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>s.connect((<span class="s4">&apos;8.8.8.8&apos;</span>, <span class="s4">80</span>))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>ip = s.getsockname()[<span class="s4">0</span>]</p>
			<p class="p2"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span><strong>finally</strong><span class="s2">:</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>s.close()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> ip</p>
			<p class="p3"><br></p>
			<p class="p1">listensocket = socket.socket()</p>
			<p class="p1">Port = <span class="s4">7000</span></p>
			<p class="p1">maxConnections = <span class="s4">999</span></p>
			<p class="p1">IP = socket.gethostname()</p>
			<p class="p3"><br></p>
			<p class="p1">listensocket.bind((getLocalIp(),Port))</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1">listensocket.listen(maxConnections)</p>
			<p class="p6"><span class="s2">print(</span>&quot;Server started at &quot;<span class="s2">&nbsp;+ IP +&nbsp;</span>&quot; on port &quot;<span class="s2">&nbsp;+ str(Port))</span></p>
			<p class="p3"><br></p>
			<p class="p1">running = <span class="s1"><strong>True</strong></span></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>def</strong></span> openDoor():</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># servo to open and pin number</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>servo = ServoControl(<span class="s4">13</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>servo.openDoor()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>time.sleep(<span class="s4">1</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>servo.closeDoor()</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># print(&quot;stop&quot;)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>pass</strong></span></p>
			<p class="p3"><br></p>
			<p class="p4"># load the user info database</p>
			<p class="p1">users = {<span class="s5">&quot;123&quot;</span>: <span class="s5">&quot;123&quot;</span>,</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span>&quot;jh2735&quot;<span class="s2">:&nbsp;</span>&quot;1234&quot;<span class="s2">,</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span>&quot;ycg534&quot;<span class="s2">:&nbsp;</span>&quot;3456&quot;<span class="s2">}</span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>def</strong></span> connectonProcess(clientsocket,queueLogin:Queue):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>message = clientsocket.recv(<span class="s4">1024</span>).decode()<span class="Apple-converted-space">&nbsp;&nbsp;</span><span class="s3"># Receives Message</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># Prints Message</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>print(message)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> message != <span class="s5">&quot;&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> message.startswith(<span class="s5">&quot;Check:&quot;</span>):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>str_list = message.split(<span class="s5">&quot;:&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> str_list[<span class="s4">1</span>] <span class="s1"><strong>in</strong></span> users:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>success = str_list[<span class="s4">2</span>] == users[str_list[<span class="s4">1</span>]]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> success:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>clientsocket.sendall(<span class="s5">b&quot;Success&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;user login success&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>queueLogin.put(str_list[<span class="s4">1</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>else</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>clientsocket.sendall(<span class="s5">b&quot;Failure&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;user login failed&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>else</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>clientsocket.sendall(<span class="s5">b&quot;Failure&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;user login failed&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> message == <span class="s5">&quot;Door Open&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;Door Open&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>clientsocket.sendall(<span class="s5">b&quot;Success&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>openDoor()</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>clientsocket.close()</p>
			<p class="p3"><br></p>
			<p class="p4"># TCP server</p>
			<p class="p1"><span class="s1"><strong>def</strong></span> rpi_TCPServer(queueLogin:Queue):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>while</strong></span> running:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>clientsocket, address = listensocket.accept()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threading.Thread(target=connectonProcess(clientsocket, queueLogin), name=<span class="s5">&quot;userName&quot;</span>).start()</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p4"># face recognition</p>
			<p class="p1"><span class="s1"><strong>def</strong></span> faceRecognition(q:Queue,frameQueue:Queue):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>classify = Classify_and_Stream()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>classify.classify_and_stream(detected, prediction, q, frameQueue,<span class="s4">5</span>)</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p4"># main interface function</p>
			<p class="p1"><span class="s1"><strong>def</strong></span> mainInterface(q: Queue, queueLogin: Queue):</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp;&nbsp;</span>GPIO four buttons callback functions and registration</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state, success</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># default state</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;MAIN&quot;</span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># GPIO 17 - user login on phone</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> GPIO17_userMain(channel):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;----user login----&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;MAIN&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;USER&quot;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;FACE&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;CHECK&quot;</span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># GPIO 22 user face login</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> GPIO22_userFaceLogin(channel):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;----userFaceLogin----&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;MAIN&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;FACE&quot;</span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># GPIO 23 user face registration</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> GPIO23_userCancel(channel):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>tuple_choice =<span class="Apple-converted-space">&nbsp;&nbsp;</span>(</span>&quot;REGISTRATION&quot;<span class="s2">,</span>&quot;USER&quot;<span class="s2">,</span>&quot;FACE&quot;<span class="s2">,</span>&quot;CHECK&quot;<span class="s2">,</span>&quot;Login&quot;<span class="s2">)</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;----user cancel----&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;MAIN&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;REGISTRATION&quot;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state <span class="s1"><strong>in</strong></span> tuple_choice:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;MAIN&quot;</span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># system exit</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> GPIO27_close(channel):</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;----system off process begin----&quot;<span class="s2">)</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># state = &quot;close&quot;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> systemOn</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>systemOn = <span class="s1"><strong>False</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>GPIO.cleanup()</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># shutdown the RPi</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>call(<span class="s5">&quot;sudo reboot&quot;</span>, shell=<span class="s1"><strong>True</strong></span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># GPIO set up</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.setup(<span class="s4">17</span>, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.setup(<span class="s4">22</span>, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.setup(<span class="s4">23</span>, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.setup(<span class="s4">27</span>, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.add_event_detect(<span class="s4">17</span>, GPIO.FALLING, callback=GPIO17_userMain, bouncetime=<span class="s4">300</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.add_event_detect(<span class="s4">22</span>, GPIO.FALLING, callback=GPIO22_userFaceLogin, bouncetime=<span class="s4">300</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.add_event_detect(<span class="s4">23</span>, GPIO.FALLING, callback=GPIO23_userCancel, bouncetime=<span class="s4">300</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GPIO.add_event_detect(<span class="s4">27</span>, GPIO.FALLING, callback=GPIO27_close, bouncetime=<span class="s4">300</span>)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>state machine control thread functions</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p3"><br></p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> checkResult(q: Queue):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> success</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;read date from queue&quot;<span class="s2">)</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># ten positive result in 3 secs</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>val = q.get(<span class="s1"><strong>True</strong></span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>success = val</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>pass</strong></span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># door open</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> openDoor():</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># servo to open and pin number</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>servo = ServoControl(<span class="s4">13</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>servo.openDoor()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>time.sleep(<span class="s4">1</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>servo.closeDoor()</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># print(&quot;stop&quot;)</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>pass</strong></span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># registration</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> registration():</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;registration&quot;</span>)</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># save photos in local file system</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>call(</span>&quot;sudo bash take_photo.sh&quot;<span class="s2">, shell=</span><span class="s1"><strong>True</strong></span><span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>time.sleep(<span class="s4">50</span>)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;registration finish&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>stateChange(<span class="s4">&apos;Cancel&apos;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>pass</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> backToMain():</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;back to main&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>time.sleep(<span class="s4">5</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;FINISH&quot;</span> <span class="s1"><strong>or</strong></span> state == <span class="s5">&quot;CHECK&quot;</span> <span class="s1"><strong>or</strong></span> state == <span class="s5">&quot;Login&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>stateChange(<span class="s4">&apos;Cancel&apos;</span>)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp;&nbsp;</span>state machine related functions</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> loginCheck(queueLogin:Queue):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> queueLogin.empty():</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>gloabal userName</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>userName = queueLogin.get(<span class="s1"><strong>True</strong></span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;USER&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = <span class="s5">&quot;Login&quot;</span></p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># state machine</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>stateMachine = {</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;Admin Login&quot;<span class="s2">:&nbsp;</span>&quot;USER&quot;<span class="s2">,</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;Face Login&quot;<span class="s2">:&nbsp;</span>&quot;FACE&quot;<span class="s2">,</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;Face Registration&quot;<span class="s2">:&nbsp;</span>&quot;REGISTRATION&quot;<span class="s2">,</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;Cancel&quot;<span class="s2">:&nbsp;</span>&quot;MAIN&quot;<span class="s2">,</span></p>
			<p class="p5"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&apos;Confirm&apos;<span class="s2">:&nbsp;</span>&apos;CHECK&apos;<span class="s2">,</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;Finish&quot;<span class="s2">:&nbsp;</span>&quot;FINISH&quot;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>}</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># button trigger state machine state change</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> stateChange(input):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>global</strong></span> state</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(input)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>state = stateMachine[input]</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>Pygame related functions</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># pygame initialization</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>pygame.init()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>pygame.mouse.set_visible(<span class="s1"><strong>False</strong></span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># screen initialization</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>size<span class="Apple-converted-space">&nbsp;&nbsp;</span>= <span class="s4">320</span>, <span class="s4">240</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>screen = pygame.display.set_mode(size)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>fontUsed = pygame.font.Font(<span class="s1"><strong>None</strong></span>, <span class="s4">30</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># draw a button on screen</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> draw_button(button, screen):</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Draw the button rect and the text surface</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, button[<span class="s4">&apos;color&apos;</span>], button[<span class="s4">&apos;rect&apos;</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>screen.blit(button[<span class="s4">&apos;text&apos;</span>], button[<span class="s4">&apos;text rect&apos;</span>])</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># create a button object: color, background, callback function, text, rect for collide detection</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> create_button(x, y, w, h, bg, text, textColor, callback):</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Create a buttondictionary of the rect, text,</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># text rect, color and the callback function.</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>FONT = pygame.font.Font(<span class="s1"><strong>None</strong></span>, <span class="s4">24</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>text_surface = FONT.render(text, <span class="s1"><strong>True</strong></span>, textColor)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>button_rect = pygame.Rect(x, y, w, h)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>text_rect = text_surface.get_rect(center=button_rect.center)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>button = {</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span><span class="s4">&apos;rect&apos;</span><span class="s2">: button_rect,<span class="Apple-converted-space">&nbsp;&nbsp;</span></span># rect to detect button detection</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s4">&apos;text&apos;</span>: text_surface,</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s4">&apos;text rect&apos;</span>: text_rect,</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s4">&apos;color&apos;</span>: bg,</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s4">&apos;callback&apos;</span>: callback,</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s4">&apos;text_text&apos;</span>: text</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>}</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> button</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> drawText(x: int, y: int, text: str, color: tuple):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>text_surface = fontUsed.render(text, <span class="s1"><strong>True</strong></span>, color)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>text_rect = text_surface.get_rect(center=(x, y))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>screen.blit(text_surface, text_rect)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># color setting</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>SHADOW = (<span class="s4">192</span>, <span class="s4">192</span>, <span class="s4">192</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>WHITE = (<span class="s4">255</span>, <span class="s4">255</span>, <span class="s4">255</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>LIGHTGREEN = (<span class="s4">0</span>, <span class="s4">255</span>, <span class="s4">0</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>GREEN = (<span class="s4">0</span>, <span class="s4">200</span>, <span class="s4">0</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>BLUE = (<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">128</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>LIGHTBLUE = (<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">255</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>RED = (<span class="s4">200</span>, <span class="s4">0</span>, <span class="s4">0</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>LIGHTRED = (<span class="s4">255</span>, <span class="s4">100</span>, <span class="s4">100</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>PURPLE = (<span class="s4">102</span>, <span class="s4">0</span>, <span class="s4">102</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>LIGHTPURPLE = (<span class="s4">153</span>, <span class="s4">0</span>, <span class="s4">153</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>BLACK = (<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">0</span>)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>interface elements</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># options buttons</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>userLogin = create_button(<span class="s4">170</span>, <span class="s4">10</span>, <span class="s4">140</span>, <span class="s4">60</span>, LIGHTGREEN, <span class="s4">&apos;Admin Login&apos;</span>, BLACK, <span class="s1"><strong>lambda</strong></span>: stateChange(<span class="s4">&apos;Admin Login&apos;</span>))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>faceRecognition = create_button(<span class="s4">170</span>, <span class="s4">85</span>, <span class="s4">140</span>, <span class="s4">60</span>, LIGHTBLUE, <span class="s4">&apos;Face Login&apos;</span>, BLACK, <span class="s1"><strong>lambda</strong></span>: stateChange(<span class="s4">&apos;Face Login&apos;</span>))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>faceRegistration = create_button(<span class="s4">170</span>, <span class="s4">160</span>, <span class="s4">140</span>, <span class="s4">60</span>, LIGHTRED, <span class="s4">&apos;Face Registration&apos;</span>, BLACK, <span class="s1"><strong>lambda</strong></span>: stateChange(<span class="s4">&apos;Face Registration&apos;</span>))</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># confirm cancel</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>cancel = create_button(<span class="s4">200</span>, <span class="s4">200</span>, <span class="s4">120</span>, <span class="s4">40</span>, RED, <span class="s4">&apos;Back To Main&apos;</span>, BLACK, <span class="s1"><strong>lambda</strong></span>: stateChange(<span class="s4">&apos;Cancel&apos;</span>))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>confirm = create_button(<span class="s4">170</span>, <span class="s4">90</span>, <span class="s4">100</span>, <span class="s4">50</span>, SHADOW, <span class="s4">&apos;Confirm&apos;</span>, BLACK, <span class="s1"><strong>lambda</strong></span>: stateChange(<span class="s4">&apos;Confirm&apos;</span>))</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># welcome interface</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_left = {</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;welcome&quot;<span class="s2">: (</span><span class="s4">60</span><span class="s2">,&nbsp;</span><span class="s4">40</span><span class="s2">,&nbsp;</span>&quot;Welcome&quot;<span class="s2">),</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s5">&quot;to&quot;</span>:(<span class="s4">60</span>,<span class="s4">80</span>,<span class="s5">&quot;To&quot;</span>),</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s5">&quot;home&quot;</span>: (<span class="s4">60</span>, <span class="s4">120</span>, <span class="s5">&quot;Home&quot;</span>),</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s5">&quot;pi&quot;</span>: (<span class="s4">60</span>, <span class="s4">180</span>, <span class="s5">&quot;Pi&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>}</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_left_list = [<span class="s4">&apos;welcome&apos;</span>, <span class="s4">&apos;to&apos;</span>,<span class="s4">&apos;home&apos;</span>, <span class="s4">&apos;pi&apos;</span>]</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text for user / face / check / registration / finish</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># user login</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_user = (<span class="s4">220</span>, <span class="s4">70</span>, <span class="s5">&quot;Login on App&quot;</span>)</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># user_success</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_success1 =<span class="Apple-converted-space">&nbsp;&nbsp;</span>(<span class="s4">220</span>,<span class="s4">70</span>,<span class="s5">&quot;Welcome&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_success2 = (<span class="s4">220</span>,<span class="s4">120</span>,<span class="s5">&quot;jh2735&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># face</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_face1 = (<span class="s4">220</span>, <span class="s4">40</span>, <span class="s5">&quot;Face camera&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_face2 = (<span class="s4">220</span>, <span class="s4">60</span>,<span class="s5">&quot;press Confirm&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># check</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_success = (<span class="s4">220</span>, <span class="s4">60</span>, <span class="s5">&quot;Welcome!&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_Fail = (<span class="s4">220</span>, <span class="s4">60</span>, <span class="s5">&quot;Face Fail&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># registration</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_reg1 = (<span class="s4">220</span>, <span class="s4">60</span>, <span class="s5">&quot;Registration&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_reg2 = (<span class="s4">220</span>, <span class="s4">120</span>, <span class="s5">&quot;Be patient&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># draw finish</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>text_finish = (<span class="s4">220</span>, <span class="s4">80</span>, <span class="s5">&quot;Please Back to Main&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># A list that contains all buttons for main interface.</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>button_list_main = [userLogin, faceRecognition, faceRegistration]</p>
			<p class="p3"><br></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span></span># a list that contains all buttons for other interfaces</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>button_list_else = [cancel, confirm]</p>
			<p class="p3"><br></p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp;</span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s5">&apos;&apos;&apos;</span></p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>thread</p>
			<p class="p6"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>&apos;&apos;&apos;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>threadOpen = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>threadCheck = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>threadRegistration = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>threadFinish = <span class="s1"><strong>None</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>while</strong></span> systemOn:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>time.sleep(<span class="s4">0.04</span>)</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># make white screen</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>screen.fill(pygame.Color(<span class="s4">&apos;white&apos;</span>))<span class="Apple-converted-space">&nbsp;&nbsp;</span><span class="s3"># Flush screen</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> state == <span class="s5">&quot;MAIN&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> button <span class="s1"><strong>in</strong></span> button_list_main:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(button, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>success = <span class="s1"><strong>False</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadOpen = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadCheck = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadRegistration = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish = <span class="s1"><strong>None</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadLogin = <span class="s1"><strong>None</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;USER&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_user[<span class="s4">0</span>], text_user[<span class="s4">1</span>], text_user[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadLogin:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadLogin = threading.Thread(target=loginCheck, name=<span class="s5">&quot;loginCheck&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadLogin.start()</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;Login&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_success1[<span class="s4">0</span>], text_success1[<span class="s4">1</span>], text_success1[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>text_success2 = (<span class="s4">220</span>,<span class="s4">120</span>,userName)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_success2[<span class="s4">0</span>], text_success2[<span class="s4">1</span>], text_success2[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadFinish:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish = threading.Thread(target=backToMain, name=<span class="s5">&quot;backToMain&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish.start()</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;FACE&quot;</span>:</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&quot;FACE:&quot;+str(success))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(confirm, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_face1[<span class="s4">0</span>], text_face1[<span class="s4">1</span>], text_face1[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_face2[<span class="s4">0</span>], text_face2[<span class="s4">1</span>], text_face2[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadCheck:</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># read the value of face recognition and copy it to success</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadCheck = threading.Thread(target=checkResult(q), name=<span class="s5">&quot;checkResult&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadCheck.start()</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;CHECK&quot;</span>:</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># check the result of face recognition</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> success:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_success[<span class="s4">0</span>], text_success[<span class="s4">1</span>], text_success[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadOpen:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadOpen = threading.Thread(target=openDoor(), name=<span class="s5">&quot;openDoor&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadOpen.start()</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>else</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s3"># refuse word</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_Fail[<span class="s4">0</span>], text_Fail[<span class="s4">1</span>], text_Fail[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadFinish:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish = threading.Thread(target=backToMain, name=<span class="s5">&quot;backToMain&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish.start()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>pass</strong></span></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;REGISTRATION&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_reg1[<span class="s4">0</span>], text_reg1[<span class="s4">1</span>], text_reg1[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_reg2[<span class="s4">0</span>], text_reg2[<span class="s4">1</span>], text_reg2[<span class="s4">2</span>], BLACK)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadRegistration:</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># read the value of face recognition and copy it to success</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadRegistration = threading.Thread(target=registration, name=<span class="s5">&quot;registration&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadRegistration.start()</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>elif</strong></span> state == <span class="s5">&quot;FINISH&quot;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.draw.rect(screen, SHADOW, [<span class="s4">0</span>, <span class="s4">0</span>, <span class="s4">120</span>, <span class="s4">240</span>])</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> text <span class="s1"><strong>in</strong></span> text_left_list:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>itemText = text_left[text]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(itemText[<span class="s4">0</span>], itemText[<span class="s4">1</span>], itemText[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>draw_button(cancel, screen)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>drawText(text_finish[<span class="s4">0</span>], text_finish[<span class="s4">1</span>], text_finish[<span class="s4">2</span>], BLACK)</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> <span class="s1"><strong>not</strong></span> threadFinish:</p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># read the value of face recognition and copy it to success</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish = threading.Thread(target=backToMain, name=<span class="s5">&quot;backToMain&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>threadFinish.start()</p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>pygame.display.flip()</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="s1"><strong>if</strong></span> __name__ == <span class="s4">&apos;__main__&apos;</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>try</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>q = Queue()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>queueLogin = Queue()</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;init video and audio&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_CCTV = Process(target=init_CCTV_video_audio)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(</span>&quot;user interface&quot;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_interface = Process(target=mainInterface, args=(q,queueLogin,))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s5">&quot;TCP Server&quot;</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_TCP_Server = Process(target=rpi_TCPServer, args(queueLogin,))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_Face_Recognition = Process(target=faceRecognition,args=(q,frameQueue))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_Face_Recognition.start()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_TCP_Server.start()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_CCTV.start()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>process_interface.start()</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p4"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># running flask stream server</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>app.run(host=<span class="s5">&quot;0.0.0.0&quot;</span>)</p>
			<p class="p3"><br></p>
			<p class="p3"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>except</strong></span> BaseException:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>traceback.print_exc()</p>
			<p class="p3"><br></p>

			<h2>Android Code - Main activity</h2>
			<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'Menlo',monospace;font-size:9.0pt;"><span style="color:#cc7832;">package </span>com.example.picctv4<span style="color:#cc7832;">;</span>
<span style="color:#cc7832;">
</span><span style="color:#cc7832;">// author jie he &amp; yuchong geng
</span><span style="color:#cc7832;">import </span>androidx.annotation.<span style="color:#bbb529;">RequiresApi</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>androidx.appcompat.app.AppCompatActivity<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">import </span>android.annotation.<span style="color:#bbb529;">SuppressLint</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.media.AudioAttributes<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.media.MediaPlayer<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.os.AsyncTask<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.os.Build<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.os.Bundle<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.webkit.WebSettings<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.webkit.WebView<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.webkit.WebViewClient<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.Button<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.EditText<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.TextView<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.Toast<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">import </span>java.io.BufferedReader<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.IOException<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.InputStreamReader<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.PrintWriter<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.net.Socket<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.net.UnknownHostException<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">public class </span>MainActivity <span style="color:#cc7832;">extends </span>AppCompatActivity {
    <span style="color:#cc7832;">private </span>EditText <span style="color:#9876aa;">usernameEditText</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>EditText <span style="color:#9876aa;">passwordEditText</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>TextView <span style="color:#9876aa;">statusTextView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>String <span style="color:#9876aa;">uName </span>= <span style="color:#6a8759;">&quot;jh2735&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>String <span style="color:#9876aa;">pwd </span>= <span style="color:#6a8759;">&quot;1234&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>TextView <span style="color:#9876aa;">doorStatusTextView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private boolean </span><span style="color:#9876aa;">success </span>= <span style="color:#cc7832;">false;
</span><span style="color:#cc7832;">    private boolean </span><span style="color:#9876aa;">doorOpen </span>= <span style="color:#cc7832;">false;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    private </span>WebView <span style="color:#9876aa;">webView</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span><span style="color:#bbb529;">@RequiresApi</span>(<span style="color:#d0d0ff;">api </span>= Build.VERSION_CODES.<span style="color:#9876aa;font-style:italic;">LOLLIPOP</span>)
    <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">protected void </span><span style="color:#ffc66d;">onCreate</span>(Bundle savedInstanceState) {
        <span style="color:#cc7832;">super</span>.onCreate(savedInstanceState)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>setContentView(R.layout.<span style="color:#9876aa;font-style:italic;">activity_main</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">statusTextView </span>= findViewById(R.id.<span style="color:#9876aa;font-style:italic;">status</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">doorStatusTextView </span>= findViewById(R.id.<span style="color:#9876aa;font-style:italic;">door</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">usernameEditText </span>= findViewById(R.id.<span style="color:#9876aa;font-style:italic;">username</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">passwordEditText </span>= findViewById(R.id.<span style="color:#9876aa;font-style:italic;">password</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        final </span>Button loginButton = findViewById(R.id.<span style="color:#9876aa;font-style:italic;">loginbtn</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        final </span>Button doorButton = findViewById(R.id.<span style="color:#9876aa;font-style:italic;">doorbtn</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">statusTextView</span>.setText(<span style="color:#6a8759;">&quot;Login Success&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">usernameEditText</span>.setText(<span style="color:#9876aa;">uName</span><span style="color:#cc7832;">, </span>TextView.BufferType.<span style="color:#9876aa;font-style:italic;">NORMAL</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">passwordEditText</span>.setText(<span style="color:#9876aa;">pwd</span><span style="color:#cc7832;">,</span>TextView.BufferType.<span style="color:#9876aa;font-style:italic;">NORMAL</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">doorStatusTextView</span>.setText(<span style="color:#6a8759;">&quot;Door Closed&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">webView </span>= (WebView) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">webView</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">// to make the webview adapt to the screen
</span><span style="color:#808080;">        </span>WebSettings settings = <span style="color:#9876aa;">webView</span>.getSettings()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>settings.setUseWideViewPort(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>settings.setLoadWithOverviewMode(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>MediaPlayer mediaPlayer = <span style="color:#cc7832;">new </span>MediaPlayer()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>mediaPlayer.setAudioAttributes(
                <span style="color:#cc7832;">new </span>AudioAttributes.Builder()
                        .setContentType(AudioAttributes.<span style="color:#9876aa;font-style:italic;">CONTENT_TYPE_MUSIC</span>)
                        .setUsage(AudioAttributes.<span style="color:#9876aa;font-style:italic;">USAGE_MEDIA</span>)
                        .build()
        )<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        try </span>{
            mediaPlayer.setDataSource(<span style="color:#6a8759;">&quot;http://192.168.1.12:8000/rapi.mp3&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>mediaPlayer.prepare()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>} <span style="color:#cc7832;">catch </span>(IOException e) {
            e.printStackTrace()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>}
        <span style="color:#808080;">//  might take long! (for buffering, etc)
</span><span style="color:#808080;">        </span>mediaPlayer.start()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">// --------
</span><span style="color:#808080;">        </span><span style="color:#9876aa;">webView</span>.setWebViewClient(<span style="color:#cc7832;">new </span>WebViewClient())<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">webView</span>.getSettings().setJavaScriptEnabled(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">webView</span>.getSettings().setDomStorageEnabled(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">webView</span>.setOverScrollMode(WebView.<span style="color:#9876aa;font-style:italic;">OVER_SCROLL_NEVER</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">webView</span>.loadUrl(<span style="color:#6a8759;">&quot;http://192.168.1.12:9000/index.html&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span>loginButton.setOnClickListener(
                (x)-&gt;{
                    <span style="color:#cc7832;">if</span>(!<span style="color:#9876aa;">success</span>){
                        <span style="color:#9876aa;">uName </span>= <span style="color:#9876aa;">usernameEditText</span>.getText().toString()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span><span style="color:#9876aa;">pwd </span>= <span style="color:#9876aa;">passwordEditText</span>.getText().toString()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        if </span>(<span style="color:#9876aa;">uName </span>== <span style="color:#cc7832;">null </span>|| <span style="color:#9876aa;">uName</span>.length() == <span style="color:#6897bb;">0 </span>|| <span style="color:#9876aa;">pwd </span>== <span style="color:#cc7832;">null </span>|| <span style="color:#9876aa;">pwd</span>.length() == <span style="color:#6897bb;">0</span>) {
                            showToast(<span style="color:#6a8759;">&quot;please fill all blanks&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            return;
</span><span style="color:#cc7832;">                        </span>}<span style="color:#cc7832;">else</span>{
                            Sender sender = <span style="color:#cc7832;">new </span>Sender()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>sender.<span style="color:#9876aa;">msg </span>= <span style="color:#6a8759;">&quot;Check:&quot;</span>+<span style="color:#9876aa;">uName</span>+<span style="color:#6a8759;">&quot;:&quot;</span>+<span style="color:#9876aa;">pwd</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>sender.<span style="color:#9876aa;">type </span>= <span style="color:#6a8759;">&quot;login&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>sender.execute()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>}
                    }<span style="color:#cc7832;">else</span>{
                        <span style="color:#9876aa;">statusTextView</span>.setText(<span style="color:#6a8759;">&quot;Login Success!&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>showToast(<span style="color:#6a8759;">&quot;You already Log in !&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>}

                }
        )<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span>doorButton.setOnClickListener(
                (x)-&gt;{
                    Sender sender = <span style="color:#cc7832;">new </span>Sender()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>sender.<span style="color:#9876aa;">msg </span>= <span style="color:#6a8759;">&quot;Door Open&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>sender.<span style="color:#9876aa;">type </span>= <span style="color:#6a8759;">&quot;doorOpen&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>sender.execute()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>}
        )<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">private void </span><span style="color:#ffc66d;">showToast</span>(String Str) {
        Toast.<span style="font-style:italic;">makeText</span>(<span style="color:#cc7832;">this, </span>Str<span style="color:#cc7832;">, </span>Toast.<span style="color:#9876aa;font-style:italic;">LENGTH_SHORT</span>).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>Toast.<span style="font-style:italic;">makeText</span>(<span style="color:#cc7832;">this, </span>Str<span style="color:#cc7832;">, </span>Toast.<span style="color:#9876aa;font-style:italic;">LENGTH_SHORT</span>).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">class </span>Sender <span style="color:#cc7832;">extends </span>AsyncTask&lt;Void<span style="color:#cc7832;">,</span>Void<span style="color:#cc7832;">,</span>Void&gt; {
        Socket <span style="color:#9876aa;">s</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>PrintWriter <span style="color:#9876aa;">pw</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>String <span style="color:#9876aa;">msg</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>String <span style="color:#9876aa;">type</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>BufferedReader <span style="color:#9876aa;">bufferedReader</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#bbb529;">@SuppressLint</span>(<span style="color:#6a8759;">&quot;SetTextI18n&quot;</span>)
        <span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">        </span><span style="color:#cc7832;">protected </span>Void <span style="color:#ffc66d;">doInBackground</span>(Void...params){
            <span style="color:#cc7832;">try </span>{
                <span style="color:#9876aa;">s </span>= <span style="color:#cc7832;">new </span>Socket(<span style="color:#6a8759;">&quot;192.168.1.12&quot;</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">7000</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">pw </span>= <span style="color:#cc7832;">new </span>PrintWriter(<span style="color:#9876aa;">s</span>.getOutputStream())<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">pw</span>.write(<span style="color:#9876aa;">msg</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">pw</span>.flush()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">bufferedReader </span>= <span style="color:#cc7832;">new </span>BufferedReader(<span style="color:#cc7832;">new </span>InputStreamReader(<span style="color:#9876aa;">s</span>.getInputStream()))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>String msg2 = <span style="color:#9876aa;">bufferedReader</span>.readLine()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                switch </span>(<span style="color:#9876aa;">type</span>) {
                    <span style="color:#cc7832;">case </span><span style="color:#6a8759;">&quot;login&quot;</span>:
                        <span style="color:#cc7832;">if </span>(msg2!=<span style="color:#cc7832;">null </span>&amp;&amp; msg2.equals(<span style="color:#6a8759;">&quot;Success&quot;</span>)) {
                            <span style="color:#9876aa;">success </span>= <span style="color:#cc7832;">true;
</span><span style="color:#cc7832;">                            </span><span style="color:#9876aa;">statusTextView</span>.setText(<span style="color:#6a8759;">&quot;Login Success&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>showToast(<span style="color:#6a8759;">&quot;Login Success&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                        </span>}<span style="color:#cc7832;">else</span>{
                            <span style="color:#9876aa;">statusTextView</span>.setText(<span style="color:#6a8759;">&quot;Not Login In&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>showToast(<span style="color:#6a8759;">&quot;Login Fail&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>}
                        <span style="color:#cc7832;">break;
</span><span style="color:#cc7832;">                    case </span><span style="color:#6a8759;">&quot;doorOpen&quot;</span>:
                        <span style="color:#cc7832;">if </span>(msg2!=<span style="color:#cc7832;">null </span>&amp;&amp; msg2.equals(<span style="color:#6a8759;">&quot;Success&quot;</span>)) {
                            <span style="color:#9876aa;">doorOpen </span>= <span style="color:#cc7832;">true;
</span><span style="color:#cc7832;">                            </span><span style="color:#9876aa;">doorStatusTextView</span>.setText(<span style="color:#6a8759;">&quot;Door Open&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>}
                }

                <span style="color:#9876aa;">bufferedReader</span>.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">pw</span>.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">s</span>.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">catch </span>(UnknownHostException e) {
                System.<span style="color:#9876aa;font-style:italic;">out</span>.println(<span style="color:#6a8759;">&quot;Fail&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>e.printStackTrace()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">catch </span>(IOException e) {
                System.<span style="color:#9876aa;font-style:italic;">out</span>.println(<span style="color:#6a8759;">&quot;Fail&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>e.printStackTrace()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">return null;
</span><span style="color:#cc7832;">        </span>}
    }
}</pre>

			<h2>Android Code - login activity</h2>
			<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'Menlo',monospace;font-size:9.0pt;"><span style="color:#cc7832;">package </span>com.example.picctv4<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">import </span>android.annotation.<span style="color:#bbb529;">SuppressLint</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.app.Activity<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.content.Context<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.content.Intent<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.content.SharedPreferences<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.os.AsyncTask<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.os.Bundle<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.view.View<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.Button<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.EditText<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.TextView<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>android.widget.Toast<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">import </span>androidx.appcompat.app.AppCompatActivity<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">import </span>java.io.BufferedReader<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.IOException<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.InputStreamReader<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.io.PrintWriter<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.net.Socket<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">import </span>java.net.UnknownHostException<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">public class </span>StartActivity <span style="color:#cc7832;">extends </span>AppCompatActivity {
    <span style="color:#cc7832;">private </span>String <span style="color:#9876aa;">host </span>= <span style="color:#6a8759;">&quot;192.168.0.8&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private int </span><span style="color:#9876aa;">TCPport </span>= <span style="color:#6897bb;">7000</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>String <span style="color:#9876aa;">uName </span>= <span style="color:#6a8759;">&quot;jh2735&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>String <span style="color:#9876aa;">pwd </span>= <span style="color:#6a8759;">&quot;1234&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    private </span>EditText <span style="color:#9876aa;">textViewUserName</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>EditText <span style="color:#9876aa;">textViewPassword</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    private </span>EditText <span style="color:#9876aa;">textViewIP</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private </span>EditText <span style="color:#9876aa;">textViewPort</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    private boolean </span><span style="color:#9876aa;">success</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    </span><span style="color:#bbb529;">@Override
</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">protected void </span><span style="color:#ffc66d;">onCreate</span>(Bundle savedInstanceState) {
        <span style="color:#cc7832;">super</span>.onCreate(savedInstanceState)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>setContentView(R.layout.<span style="color:#9876aa;font-style:italic;">activity_start</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">//Get the last IP and port value, and show them
</span><span style="color:#808080;">        // get the textView object
</span><span style="color:#808080;">        </span><span style="color:#9876aa;">textViewIP </span>= (EditText) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">systemIP</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">textViewPort </span>= (EditText) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">systemPort</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">textViewPassword </span>= (EditText) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">systmePassword</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">textViewUserName </span>= (EditText) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">systemUserName</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">// set default host and port
</span><span style="color:#808080;">        </span><span style="color:#9876aa;">textViewUserName</span>.setText(<span style="color:#9876aa;">uName</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">textViewPassword</span>.setText(<span style="color:#9876aa;">pwd</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#808080;">// set default host and port
</span><span style="color:#808080;">        </span><span style="color:#9876aa;">textViewIP</span>.setText(<span style="color:#9876aa;">host</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">textViewPort</span>.setText(String.<span style="font-style:italic;">valueOf</span>(<span style="color:#9876aa;">TCPport</span>))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span><span style="color:#9876aa;">success </span>= <span style="color:#cc7832;">false;
</span><span style="color:#cc7832;">        </span>Button buttonEnter = (Button) findViewById(R.id.<span style="color:#9876aa;font-style:italic;">enter</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>buttonEnter.setOnClickListener(

                (x) -&gt; {
                    <span style="color:#9876aa;">uName </span>= <span style="color:#9876aa;">textViewUserName</span>.getText().toString()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span><span style="color:#9876aa;">pwd </span>= <span style="color:#9876aa;">textViewPassword</span>.getText().toString()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>host = textViewIP.getText().toString()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                    </span>TCPport = Integer.valueOf(textViewPort.getText().toString())<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                    if </span>(uName == <span style="color:#cc7832;">null </span>|| uName.length() == <span style="color:#6897bb;">0 </span>|| pwd == <span style="color:#cc7832;">null </span>|| pwd.length() == <span style="color:#6897bb;">0</span>) {
                        showToast(<span style="color:#6a8759;">&quot;please fill all blanks&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        return;
</span><span style="color:#cc7832;">                    </span>}<span style="color:#cc7832;">else</span>{
                        StartActivity.Sender sender = <span style="color:#cc7832;">new  </span>StartActivity.Sender()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>sender.host = host<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>sender.port = TCPport<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>sender.msg = <span style="color:#6a8759;">&quot;Check:&quot;</span>+uName+<span style="color:#6a8759;">&quot;:&quot;</span>+pwd<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>sender.type = <span style="color:#6a8759;">&quot;login&quot;</span><span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        </span>sender.execute()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        long </span>timeInit = System.currentTimeMillis()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                        while</span>(System.currentTimeMillis() - timeInit&lt;<span style="color:#6897bb;">3000</span>){
                            <span style="color:#cc7832;">if </span>(success){
                                Intent startMainActivityIntent = <span style="color:#cc7832;">new </span>Intent(StartActivity.<span style="color:#cc7832;">this, </span>MainActivity.<span style="color:#cc7832;">class</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                                </span>startActivity(startMainActivityIntent)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                                </span>finish()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                            </span>}
                        }
                    }
                })<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">    </span>}
    <span style="color:#cc7832;">private void </span>showToast (String Str) {
        Toast.makeText(<span style="color:#cc7832;">this, </span>Str<span style="color:#cc7832;">, </span>Toast.LENGTH_SHORT).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>Toast.makeText(<span style="color:#cc7832;">this, </span>Str<span style="color:#cc7832;">, </span>Toast.LENGTH_SHORT).show()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">    </span>}
    <span style="color:#cc7832;">class </span>Sender <span style="color:#cc7832;">extends </span>AsyncTask&lt;Void<span style="color:#cc7832;">,</span>Void<span style="color:#cc7832;">,</span>Void&gt; {
        Socket s<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>PrintWriter pw<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>String msg<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>String type<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>BufferedReader bufferedReader<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        </span>String host<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">        int </span>port<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">        </span>@SuppressLint(<span style="color:#6a8759;">&quot;SetTextI18n&quot;</span>)
        @Override
        <span style="color:#cc7832;">protected </span>Void doInBackground(Void...params){
            <span style="color:#cc7832;">try </span>{
                s = <span style="color:#cc7832;">new </span>Socket(host<span style="color:#cc7832;">, </span>port)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>pw = <span style="color:#cc7832;">new </span>PrintWriter(s.getOutputStream())<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>pw.write(msg)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>pw.flush()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>bufferedReader = <span style="color:#cc7832;">new </span>BufferedReader(<span style="color:#cc7832;">new </span>InputStreamReader(s.getInputStream()))<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>String msg2 = bufferedReader.readLine()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">                switch </span>(type) {
                    <span style="color:#cc7832;">case </span><span style="color:#6a8759;">&quot;login&quot;</span>:
                        <span style="color:#cc7832;">if </span>(msg2!=<span style="color:#cc7832;">null </span>&amp;&amp; msg2.equals(<span style="color:#6a8759;">&quot;Success&quot;</span>)) {
                            success = <span style="color:#cc7832;">true;
</span><span style="color:#cc7832;">                        </span>}<span style="color:#cc7832;">else</span>{

                        }
                        <span style="color:#cc7832;">break;
</span><span style="color:#cc7832;">                </span>}

                bufferedReader.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>pw.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>s.close()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">catch </span>(UnknownHostException e) {
                System.out.println(<span style="color:#6a8759;">&quot;Fail&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>e.printStackTrace()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">catch </span>(IOException e) {
                System.out.println(<span style="color:#6a8759;">&quot;Fail&quot;</span>)<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">                </span>e.printStackTrace()<span style="color:#cc7832;">;
</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">return null;
</span><span style="color:#cc7832;">        </span>}
    }
}
				<h2> CCTV Server</h2>
			<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'JetBrains Mono',monospace;font-size:9.8pt;"><span style="color:#808080;"># Web streaming example
</span><span style="color:#808080;"># Source code from the official PiCamera package
</span><span style="color:#808080;"># http://picamera.readthedocs.io/en/latest/recipes2.html#web-streaming
</span><span style="color:#808080;">
</span><span style="color:#cc7832;">import </span>io
<span style="color:#cc7832;">import </span>picamera
<span style="color:#cc7832;">import </span>logging
<span style="color:#cc7832;">import </span>socketserver
<span style="color:#cc7832;">from </span>threading <span style="color:#cc7832;">import </span>Condition
<span style="color:#cc7832;">from </span>http <span style="color:#cc7832;">import </span>server


PAGE=<span style="color:#6a8759;">&quot;&quot;&quot;</span><span style="color:#cc7832;">\
</span><span style="color:#6a8759;">&lt;html&gt;
</span><span style="color:#6a8759;">&lt;head&gt;
</span><span style="color:#6a8759;">&lt;title&gt;Home Pi CCTV&lt;/title&gt;
</span><span style="color:#6a8759;">&lt;/head&gt;
</span><span style="color:#6a8759;">&lt;body&gt;
</span><span style="color:#6a8759;">&lt;center&gt;&lt;h1&gt;Home Pi CCTV&lt;/h1&gt;&lt;/center&gt;
</span><span style="color:#6a8759;">&lt;center&gt;&lt;h2 id=&quot;linkweb&quot;&gt;&lt;/h2&gt;&lt;/center&gt;
</span><span style="color:#6a8759;">&lt;script&gt;setInterval(&quot;linkweb.innerHTML=new Date().toLocaleString();&quot;,1000);
</span><span style="color:#6a8759;">&lt;/script&gt;
</span><span style="color:#6a8759;">&lt;center&gt;&lt;img src=&quot;stream.mjpg&quot; width=&quot;640&quot; height=&quot;480&quot;&gt;&lt;/center&gt;
</span><span style="color:#6a8759;">
</span><span style="color:#6a8759;">&lt;/body&gt;
</span><span style="color:#6a8759;">&lt;/html&gt;
</span><span style="color:#6a8759;">&quot;&quot;&quot;
</span><span style="color:#6a8759;">
</span><span style="color:#cc7832;">class </span>StreamingOutput(<span style="color:#8888c6;">object</span>):
    <span style="color:#cc7832;">def </span><span style="color:#b200b2;">__init__</span>(<span style="color:#94558d;">self</span>):
        <span style="color:#94558d;">self</span>.frame = <span style="color:#cc7832;">None
</span><span style="color:#cc7832;">        </span><span style="color:#94558d;">self</span>.buffer = io.BytesIO()
        <span style="color:#94558d;">self</span>.condition = Condition()

    <span style="color:#cc7832;">def </span><span style="color:#ffc66d;">write</span>(<span style="color:#94558d;">self</span><span style="color:#cc7832;">, </span>buf):
        <span style="color:#cc7832;">if </span>buf.startswith(<span style="color:#a5c261;">b&apos;</span><span style="color:#cc7832;">\xff\xd8</span><span style="color:#a5c261;">&apos;</span>):
            <span style="color:#808080;"># New frame, copy the existing buffer&apos;s content and notify all
</span><span style="color:#808080;">            # clients it&apos;s available
</span><span style="color:#808080;">            </span><span style="color:#94558d;">self</span>.buffer.truncate()
            <span style="color:#cc7832;">with </span><span style="color:#94558d;">self</span>.condition:
                <span style="color:#94558d;">self</span>.frame = <span style="color:#94558d;">self</span>.buffer.getvalue()
                <span style="color:#94558d;">self</span>.condition.notify_all()
            <span style="color:#94558d;">self</span>.buffer.seek(<span style="color:#6897bb;">0</span>)
        <span style="color:#cc7832;">return </span><span style="color:#94558d;">self</span>.buffer.write(buf)

<span style="color:#cc7832;">class </span>StreamingHandler(server.BaseHTTPRequestHandler):
    <span style="color:#808080;"># get request
</span><span style="color:#808080;">    </span><span style="color:#cc7832;">def </span><span style="color:#ffc66d;">do_GET</span>(<span style="color:#94558d;">self</span>):
        <span style="color:#cc7832;">if </span><span style="color:#94558d;">self</span>.path == <span style="color:#6a8759;">&apos;/&apos;</span>:
            <span style="color:#94558d;">self</span>.send_response(<span style="color:#6897bb;">301</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Location&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;/index.html&apos;</span>)
            <span style="color:#94558d;">self</span>.end_headers()
        <span style="color:#cc7832;">elif </span><span style="color:#94558d;">self</span>.path == <span style="color:#6a8759;">&apos;/index.html&apos;</span>:
            content = PAGE.encode(<span style="color:#6a8759;">&apos;utf-8&apos;</span>)
            <span style="color:#94558d;">self</span>.send_response(<span style="color:#6897bb;">200</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Content-Type&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;text/html&apos;</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Content-Length&apos;</span><span style="color:#cc7832;">, </span><span style="color:#8888c6;">len</span>(content))
            <span style="color:#94558d;">self</span>.end_headers()
            <span style="color:#94558d;">self</span>.wfile.write(content)
        <span style="color:#cc7832;">elif </span><span style="color:#94558d;">self</span>.path == <span style="color:#6a8759;">&apos;/stream.mjpg&apos;</span>:
            <span style="color:#94558d;">self</span>.send_response(<span style="color:#6897bb;">200</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Age&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">0</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Cache-Control&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;no-cache, private&apos;</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Pragma&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;no-cache&apos;</span>)
            <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Content-Type&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;multipart/x-mixed-replace; boundary=FRAME&apos;</span>)
            <span style="color:#94558d;">self</span>.end_headers()
            <span style="color:#cc7832;">try</span>:
                <span style="color:#cc7832;">while True</span>:
                    <span style="color:#cc7832;">with </span>output.condition:
                        output.condition.wait()
                        frame = output.frame
                    <span style="color:#94558d;">self</span>.wfile.write(<span style="color:#a5c261;">b&apos;--FRAME</span><span style="color:#cc7832;">\r\n</span><span style="color:#a5c261;">&apos;</span>)
                    <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Content-Type&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6a8759;">&apos;image/jpeg&apos;</span>)
                    <span style="color:#94558d;">self</span>.send_header(<span style="color:#6a8759;">&apos;Content-Length&apos;</span><span style="color:#cc7832;">, </span><span style="color:#8888c6;">len</span>(frame))
                    <span style="color:#94558d;">self</span>.end_headers()
                    <span style="color:#94558d;">self</span>.wfile.write(frame)
                    <span style="color:#94558d;">self</span>.wfile.write(<span style="color:#a5c261;">b&apos;</span><span style="color:#cc7832;">\r\n</span><span style="color:#a5c261;">&apos;</span>)
            <span style="color:#cc7832;">except </span><span style="color:#8888c6;">Exception </span><span style="color:#cc7832;">as </span>e:
                logging.warning(
                    <span style="color:#6a8759;">&apos;Removed streaming client %s: %s&apos;</span><span style="color:#cc7832;">,
</span><span style="color:#cc7832;">                    </span><span style="color:#94558d;">self</span>.client_address<span style="color:#cc7832;">, </span><span style="color:#8888c6;">str</span>(e))
        <span style="color:#cc7832;">else</span>:
            <span style="color:#94558d;">self</span>.send_error(<span style="color:#6897bb;">404</span>)
            <span style="color:#94558d;">self</span>.end_headers()

<span style="color:#cc7832;">class </span>StreamingServer(socketserver.ThreadingMixIn<span style="color:#cc7832;">, </span>server.HTTPServer):
    allow_reuse_address = <span style="color:#cc7832;">True
</span><span style="color:#cc7832;">    </span>daemon_threads = <span style="color:#cc7832;">True
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">
</span><span style="color:#cc7832;">if </span>__name__ == <span style="color:#6a8759;">&apos;__main__&apos;</span>:
    <span style="color:#8888c6;">print</span>(<span style="color:#6a8759;">&quot;-----CCTV Server----&quot;</span>)
    <span style="color:#cc7832;">with </span>picamera.PiCamera(<span style="color:#aa4926;">resolution</span>=<span style="color:#6a8759;">&apos;640x480&apos;</span><span style="color:#cc7832;">, </span><span style="color:#aa4926;">framerate</span>=<span style="color:#6897bb;">24</span>) <span style="color:#cc7832;">as </span>camera:
        output = StreamingOutput()
        <span style="color:#808080;">#Uncomment the next line to change your Pi&apos;s Camera rotation (in degrees)
</span><span style="color:#808080;">        #camera.rotation = 90
</span><span style="color:#808080;">        </span>camera.start_recording(output<span style="color:#cc7832;">, </span><span style="color:#aa4926;">format</span>=<span style="color:#6a8759;">&apos;mjpeg&apos;</span>)
        <span style="color:#cc7832;">try</span>:
            address = (<span style="color:#6a8759;">&apos;&apos;</span><span style="color:#cc7832;">, </span><span style="color:#6897bb;">9000</span>)
            server = StreamingServer(address<span style="color:#cc7832;">, </span>StreamingHandler)
            server.serve_forever()
        <span style="color:#cc7832;">finally</span>:
            camera.stop_recording()

</pre>



</pre>

			<h2>face recognition</h2>

			<style type="text/css">
				p.p1 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #ffffff;
					color: rgba(255, 255, 255, 0.85);
					background-color: #1f1f24
				}

				p.p2 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #fc5fa3;
					background-color: #1f1f24
				}

				p.p3 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #fc6a5d;
					background-color: #1f1f24
				}

				p.p4 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #ffffff;
					color: rgba(255, 255, 255, 0.85);
					background-color: #1f1f24;
					min-height: 14.0px
				}

				p.p5 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #d0bf69;
					background-color: #1f1f24
				}

				p.p6 {
					margin: 0.0px 0.0px 0.0px 0.0px;
					font: 12.0px Menlo;
					color: #6c7986;
					background-color: #1f1f24
				}

				span.s1 {
					color: #fc5fa3
				}

				span.s2 {
					color: rgba(255, 255, 255, 0.85)
				}

				span.s3 {
					color: #d0bf69
				}
			</style>
			<p class="p1"><span class="s1"><strong>import</strong></span> numpy <span class="s1"><strong>as</strong></span> np</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;cv2</span></p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;sys</span></p>
			<p class="p1"><span class="s1"><strong>from</strong></span> multiprocessing <span class="s1"><strong>import</strong></span> Process, Queue, Pool</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;zmq</span></p>
			<p class="p1"><span class="s1"><strong>import</strong></span> base64</p>
			<p class="p3">&quot;&quot;&quot;</p>
			<p class="p3">python3 examples/semantic_segmentation.py \</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp;&nbsp;</span>--model test_data/deeplabv3_mnv2_pascal_quant_edgetpu.tflite \</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp;&nbsp;</span>--input test_data/bird.bmp \</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp;&nbsp;</span>--keep_aspect_ratio \</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp;&nbsp;</span>--output ${HOME}/segmentation_result.jpg</p>
			<p class="p3">&quot;&quot;&quot;</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="s1"><strong>import</strong></span> argparse</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;time</span></p>
			<p class="p1"><span class="s1"><strong>import</strong></span> numpy <span class="s1"><strong>as</strong></span> np</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> PIL <span class="s1"><strong>import</strong></span> Image</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pycoral.adapters <span class="s1"><strong>import</strong></span> common</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pycoral.adapters <span class="s1"><strong>import</strong></span> segment</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pycoral.utils.edgetpu <span class="s1"><strong>import</strong></span> make_interpreter</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pycoral.adapters <span class="s1"><strong>import</strong></span> classify</p>
			<p class="p1"><span class="s1"><strong>from</strong></span> pycoral.utils.dataset <span class="s1"><strong>import</strong></span> read_label_file</p>
			<p class="p1"><span class="s1"><strong>from</strong></span><span class="Apple-converted-space">&nbsp;&nbsp;</span>testCheck <span class="s1"><strong>import</strong></span> checkPIcam, executeandsearch</p>
			<p class="p2"><strong>import</strong><span class="s2">&nbsp;os</span></p>
			<p class="p4"><br></p>
			<p class="p1"><span class="s1"><strong>class</strong></span> Classify_and_Stream:</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> create_pascal_label_colormap(self):</p>
			<p class="p3"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;&quot;&quot;Creates a label colormap used in PASCAL VOC segmentation benchmark.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>Returns:</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>A Colormap for visualizing segmentation results.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>&quot;&quot;&quot;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>colormap = np.zeros((<span class="s3">256</span>, <span class="s3">3</span>), dtype=int)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>indices = np.arange(<span class="s3">256</span>, dtype=int)</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> shift <span class="s1"><strong>in</strong></span> reversed(range(<span class="s3">8</span>)):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> channel <span class="s1"><strong>in</strong></span> range(<span class="s3">3</span>):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>colormap[:, channel] |= ((indices &gt;&gt; channel) &amp; <span class="s3">1</span>) &lt;&lt; shift</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>indices &gt;&gt;= <span class="s3">3</span></p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> colormap</p>
			<p class="p4"><br></p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> label_to_color_image(self, label):</p>
			<p class="p3"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>&quot;&quot;&quot;Adds color defined by the dataset colormap to the label.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>Args:</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>label: A 2D array with integer type, storing the segmentation label.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>Returns:</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result: A 2D array with floating type. The element of the array</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>is the color indexed by the corresponding element in the input label</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>to the PASCAL color map.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>Raises:</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>ValueError: If label is not of rank 2 or its value is larger than color</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>map maximum entry.</p>
			<p class="p3"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>&quot;&quot;&quot;</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> label.ndim != <span class="s3">2</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>raise</strong></span> ValueError(<span class="s3">&apos;Expect 2-D input label&apos;</span>)</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>colormap = self.create_pascal_label_colormap()</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> np.max(label) &gt;= len(colormap):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>raise</strong></span> ValueError(<span class="s3">&apos;label value too large.&apos;</span>)</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>return</strong></span> colormap[label]</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>def</strong></span> classify_and_stream(self, detected, prediction, queue:Queue, frameQueue:Queue, buffer_count=<span class="s3">5</span>):</p>
			<p class="p5"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter_seg = make_interpreter(</span>&apos;/home/pi/rpi-face/deeplabv3_mnv2_pascal_quant_edgetpu.tflite&apos;<span class="s2">, device=</span>&apos;:0&apos;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter_seg.allocate_tensors()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>width, height = common.input_size(interpreter_seg)</p>
			<p class="p4"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> (checkPIcam(<span class="s3">&apos;video0&apos;</span>)):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>cap = cv2.VideoCapture(<span class="s3">1</span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>else</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>cap = cv2.VideoCapture(<span class="s3">0</span>)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># counter for classification results:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result_counter = [<span class="s3">0</span>,<span class="s3">0</span>,<span class="s3">0</span>]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>while</strong></span>(<span class="s1"><strong>True</strong></span>):</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Capture frame-by-frame</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>ret, frame = cap.read()</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#convert opencv image to PIL image</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>img = Image.fromarray(frame)</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#classification:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>labels = read_label_file(<span class="s3">&apos;/home/pi/final_project/label_map.txt&apos;</span>)</p>
			<p class="p4"><br></p>
			<p class="p5"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter = make_interpreter(</span>&apos;/home/pi/final_project/retrained_model_edgetpu.tflite&apos;<span class="s2">)</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter.allocate_tensors()</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>size = common.input_size(interpreter)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>image = img.resize(size, Image.ANTIALIAS)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>common.set_input(interpreter, image)</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>start = time.perf_counter()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter.invoke()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>inference_time = time.perf_counter() - start</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>classes = classify.get_classes(interpreter, <span class="s3">1</span>, <span class="s3">0.0</span>)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&apos;%.1fms&apos; % (inference_time * 1000))</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&apos;-------RESULTS--------&apos;)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>for</strong></span> c <span class="s1"><strong>in</strong></span> classes:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(<span class="s3">&apos;%s: %.5f&apos;</span> % (labels.get(c.id, c.id), c.score))</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># determine if door should be opened</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result_counter[c.id] += <span class="s3">1</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> (result_counter[c.id] &gt;= buffer_count):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result_counter[<span class="s3">0</span>] = <span class="s3">0</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result_counter[<span class="s3">1</span>] = <span class="s3">0</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result_counter[<span class="s3">2</span>] = <span class="s3">0</span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>prediction = labels.get(c.id, c.id)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> (prediction == <span class="s3">&apos;negative&apos;</span>):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>detected = <span class="s1"><strong>False</strong></span></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>else</strong></span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>detected = <span class="s1"><strong>True</strong></span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&quot;write in queue&quot;)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>while</strong></span> (queue.qsize() &gt; <span class="s3">2</span>):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>queue.get(<span class="s1"><strong>True</strong></span>)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>queue.put(detected)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(detected)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>print(prediction)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span># fifo = open(FIFO, &apos;w&apos;)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span># print(&quot;write in&quot;)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span># fifo.write(str(detected))</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span># fifo.close()</p>
			<p class="p4"><br></p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#start = time.perf_counter()</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># segmentation</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>resized_img, _ = common.set_resized_input(</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter_seg, img.size, <span class="s1"><strong>lambda</strong></span> size: img.resize(size, Image.ANTIALIAS))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>start = time.perf_counter()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>interpreter_seg.invoke()</p>
			<p class="p4"><br></p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result = segment.get_output(interpreter_seg)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>end = time.perf_counter()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> len(result.shape) == <span class="s3">3</span>:</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result = np.argmax(result, axis=<span class="s3">-1</span>)</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># If keep_aspect_ratio, we need to remove the padding area.</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>new_width, new_height = resized_img.size</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>result = result[:new_height, :new_width]</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>mask_img = Image.fromarray(self.label_to_color_image(result).astype(np.uint8))</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#end = time.perf_counter()</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Concat resized input image and processed segmentation results.</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>output_img = Image.new(<span class="s3">&apos;RGB&apos;</span>, (<span class="s3">2</span> * new_width, new_height))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>output_img.paste(resized_img, (<span class="s3">0</span>, <span class="s3">0</span>))</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>output_img.paste(mask_img, (width, <span class="s3">0</span>))</p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#end = time.perf_counter()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>seg_time = end - start<span class="Apple-converted-space">&nbsp;</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&apos;segmentation time: %0.1fms&apos; % (seg_time * 1000))</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#print(&apos;classification time: %.1fms&apos; % (inference_time * 1000))</p>
			<p class="p4"><br></p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#convert PIL image to opencv form</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>open_cv_image = np.array(output_img)</p>
			<p class="p4"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#frame = cv2.resize(open_cv_image, (640, 480))<span class="Apple-converted-space">&nbsp;&nbsp;</span># resize the frame</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>frameQueue.put(open_cv_image)</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># Display the resulting frame</p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span>#cv2.imshow(&apos;frame&apos;, open_cv_image)</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>if</strong></span> cv2.waitKey(<span class="s3">1</span>) &amp; <span class="s3">0xFF</span> == ord(<span class="s3">&apos;q&apos;</span>):</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span class="s1"><strong>break</strong></span></p>
			<p class="p4"><br></p>
			<p class="p6"><span class="s2"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></span># When everything done, release the capture</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>cap.release()</p>
			<p class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>cv2.destroyAllWindows()</p>

        </div><!-- end container -->
    </footer><!-- end footer -->

    <div class="copyrights">
        <div class="container">
            <div class="footer-distributed">
                <div class="footer-center">                   
                    <p class="footer-company-name">Copyright &copy; 2020 Jie He & YuChong Geng.</p>
                </div>
            </div>
        </div><!-- end container -->
    </div><!-- end copyrights -->

    <a href="#" id="scroll-to-top" class="dmtop global-radius"><i class="fa fa-angle-up"></i></a>

    <!-- ALL JS FILES -->
    <script src="js/all.js"></script>
    <!-- ALL PLUGINS -->
    <script src="js/custom.js"></script>
	<script src="js/timeline.min.js"></script>
	<script>
		timeline(document.querySelectorAll('.timeline'), {
			forceVerticalMode: 700,
			mode: 'horizontal',
			verticalStartPosition: 'left',
			visibleItems: 4
		});
	</script>
</body>
</html>